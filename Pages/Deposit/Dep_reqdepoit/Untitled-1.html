//DepWithdraw

@if (datadetail == null)
	{
		<div class="card body-page">
			<div class="row" style="margin-left: calc(var(--bs-gutter-x) * .5);margin-bottom: 15px;">
				<form @onsubmit="PerformSearch">
					<div class="row">
						<div class="col-xl-4 col-md-4 col-sm-6 d-flex flex-column">
							<label class="form-label" for="">เลขที่บัญชี</label>
							<div class="form-group ">
								<div class="input-group">
									<RadzenMask Mask="**-********" CharacterPattern="[0-9]" @bind-value="deptno_format"
										Name="deptaccount_no" class="form-control" @onkeydown="@HandleEnterKeyPress" />
									<div class="input-group-addon">
										<RadzenIcon class="icons icon-search" @onclick="GetDeptMaintype" Icon="ballot"
											data-bs-toggle="modal" data-bs-target="#ModalSearch" />
									</div>
								</div>
							</div>
							<div class="modal" id="ModalSearch">
								<div class="modal-dialog modal-xl">
									<div class="modal-content">
										<!-- Modal Header -->
										<div class="modal-header">
											<h4 class="modal-title">ข้อมูลสมาชิก</h4>
											<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
										</div>
										<!-- Modal body -->
										<div class="modal-body">
											<div class="row" style="margin-left:-4px;margin-right:-4px;">
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ประเภทบัญชี</label>
													@if (getDeptMaintype != null)
													{
														<select id="DeptMaintype" name="DeptMaintype" class="form-select"
															@onchange="DeptMaintype">
															<option value="null" selected>--กรุณาเลือก--</option>
															@foreach (var MaintypeItem in getDeptMaintype)
															{
																<option value="@MaintypeItem.deptmain_type">
																	@MaintypeItem.deptmain_type - @MaintypeItem.deptmain_desc
																</option>
															}
														</select>
													}
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">เลขที่บัญชี</label>
													<div class="form-group ">
														<div class="input-group">
															@* <input class="form-control" type="text" name="emp_name"
													@bind-value="deptaccount_no"> *@
															<RadzenMask Mask="**-********" CharacterPattern="[0-9]"
																@bind-value="deptaccount_No_fild" Name="deptaccount_No_fild"
																class="form-control" />

														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ชื่อบัญชี :</label>
													<div class="form-group ">
														<div class="input-group">
															<input class="form-control" type="text" name="deptaccount_name_fild"
																@bind-value="deptaccount_name_fild">

														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">สถานะบัญชี</label>
													<select class="form-select" @bind="deptclose_status"
														>
														<option Value="0">เปิดบัญชี</option>
														<option Value="1">ปิดบัญชี</option>
													</select>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">เลขที่สมาชิก</label>
													<div class="form-group ">
														<div class="input-group">
															<input class="form-control" type="text" name="memb_name"
																@bind-value="member_no">

														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">เลขพนักงาน</label>
													<div class="form-group ">
														<div class="input-group">
															<input class="form-control" type="text" name="salary_id"
																@bind-value="salary_id">
														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ชื่อ</label>
													<div class="form-group ">
														<div class="input-group">
															<input class="form-control" type="text" name="memb_name"
																@bind-value="memb_name">

														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">นามสกุล</label>
													<div class="form-group ">
														<div class="input-group">
															<input class="form-control" type="text" name="memb_surname"
																@bind-value="memb_surname">
														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">บัตรประชาชน :</label>
													<div class="form-group ">
														<div class="input-group">
															<input class="form-control" type="text" name="card_person"
																@bind-value="card_person">

														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">เบอร์โทรศัพท์ :</label>
													<div class="form-group ">
														<div class="input-group">
															<input class="form-control" type="text" name="mem_telmobile"
																@bind-value="mem_telmobile">
														</div>
													</div>
												</div>
												<div class="col-xl-2 col-md-6 col-sm-6 d-flex flex-column">
													<button class="btn btn-outline-secondary"
														@onclick="SearchOfGetAcc">ค้นหา</button>
												</div>
											</div>
											<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails"
												ColumnWidth="200px" AllowFiltering="true"
												FilterPopupRenderMode="PopupRenderMode.OnDemand"
												FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10"
												AllowPaging="true" AllowSorting="true"
												PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
												<Columns>
													<RadzenDataGridColumn Width="20%" TItem="Models.AccountDetails"
														Title="เลขที่บัญชี" Property="deptaccount_no">
														<Template>
															<div @onclick="@(e => UpdateAccountDetails(context))"
																data-bs-dismiss="modal">
																@context.deptaccount_no
															</div>
														</Template>
													</RadzenDataGridColumn>

													<RadzenDataGridColumn Width="30%" TItem="Models.AccountDetails"
														Title="ชื่อบัญชี" Property="deptaccount_name">
														<Template>
															<div @onclick="@(e => UpdateAccountDetails(context))"
																data-bs-dismiss="modal">
																@context.deptaccount_name
															</div>
														</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="20%" TItem="Models.AccountDetails"
														Title="เลขสมาชิก" Property="member_no">
														<Template>
															<div @onclick="@(e => UpdateAccountDetails(context))"
																data-bs-dismiss="modal">
																@context.member_no
															</div>
														</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="30%" TItem="Models.AccountDetails"
														Title=" ชื่อ -นามสกุล" Property="full_name">
														<Template>
															<div @onclick="@(e => UpdateAccountDetails(context))"
																data-bs-dismiss="modal">
																@context.full_name
															</div>
														</Template>
													</RadzenDataGridColumn>
												</Columns>
											</RadzenDataGrid>

										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-xl-1 col-md-2 col-sm-6 d-flex flex-column">
							@* <button type="button" class="btn btn-outline-secondary" @onclick="PerformSearch">ค้นหา</button>
					*@
							<button type="submit" class="btn btn-outline-secondary">ค้นหา</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	}
	else
	{
		<div class="card body-page">
			<div class="from">
				<form @onsubmit="PerformSearch">
					@foreach (var item in datadetail)
					{
						var Item = item.deptSlip;
						<div class="row" style="margin-left: calc(var(--bs-gutter-x) * .5);margin-bottom: 15px;">
							<div class="row">
								<div class="col-xl-3 col-md-4 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">เลขที่บัญชี</label>
									<div class="form-group ">
										<div class="input-group">
											@* <input class="form-control" type="text" name="deptaccount_no" @bind="deptaccount_no">
								*@
											<RadzenMask Mask="**-********" CharacterPattern="[0-9]" @bind-value="deptno_format"
												Name="deptaccount_no" class="form-control" @onkeydown="@HandleEnterKeyPress" />
											<div class="input-group-addon">
												<RadzenIcon class="icons icon-search" @onclick="GetDeptMaintype" Icon="ballot"
													data-bs-toggle="modal" data-bs-target="#anotherModal" />
											</div>
										</div>
									</div>
									<div class="modal" id="anotherModal">
										<div class="modal-dialog modal-xl">
											<div class="modal-content">
												<!-- Modal Header -->
												<div class="modal-header">
													<h4 class="modal-title">ข้อมูลสมาชิก</h4>
													<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
												</div>
												<!-- Modal body -->
												<div class="modal-body">
													<div class="row" style="margin-left:-4px;margin-right:-4px;">
														<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
															<label class="form-label" for="">ประเภทบัญชี</label>
															@if (getDeptMaintype != null)
															{
																<select id="DeptMaintype" name="DeptMaintype" class="form-select"
																	@onchange="DeptMaintype">
																	<option value="null" selected>--กรุณาเลือก--</option>
																	@foreach (var MaintypeItem in getDeptMaintype)
																	{
																		<option value="@MaintypeItem.deptmain_type">
																			@MaintypeItem.deptmain_type - @MaintypeItem.deptmain_desc
																		</option>
																	}
																</select>
															}
														</div>
														<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
															<label class="form-label" for="">เลขที่บัญชี</label>
															<div class="form-group ">
																<div class="input-group">
																	@* <input class="form-control" type="text" name="emp_name"
														@bind-value="deptaccount_no"> *@
																	<RadzenMask Mask="**-********" CharacterPattern="[0-9]"
																		@bind-value="deptaccount_No_fild" Name="deptaccount_no"
																		class="form-control" />

																</div>
															</div>
														</div>
														<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
															<label class="form-label" for="">ชื่อบัญชี :</label>
															<div class="form-group ">
																<div class="input-group">
																	<input class="form-control" type="text" name="emp_name"
																		@bind-value="deptaccount_name_fild">

																</div>
															</div>
														</div>
														<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
															<label class="form-label" for="">สถานะบัญชี</label>
															<select class="form-select" @bind="deptclose_status"
																>
																<option Value="0">เปิดบัญชี</option>
																<option Value="1">ปิดบัญชี</option>
															</select>
														</div>
														<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
															<label class="form-label" for="">เลขที่สมาชิก</label>
															<div class="form-group ">
																<div class="input-group">
																	<input class="form-control" type="text" name="memb_name"
																		@bind-value="member_no">

																</div>
															</div>
														</div>
														<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
															<label class="form-label" for="">เลขพนักงาน</label>
															<div class="form-group ">
																<div class="input-group">
																	<input class="form-control" type="text" name="salary_id"
																		@bind-value="salary_id">
																</div>
															</div>
														</div>
														<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
															<label class="form-label" for="">ชื่อ</label>
															<div class="form-group ">
																<div class="input-group">
																	<input class="form-control" type="text" name="memb_name"
																		@bind-value="memb_name">

																</div>
															</div>
														</div>
														<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
															<label class="form-label" for="">นามสกุล</label>
															<div class="form-group ">
																<div class="input-group">
																	<input class="form-control" type="text" name="memb_surname"
																		@bind-value="memb_surname">
																</div>
															</div>
														</div>
														<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
															<label class="form-label" for="">บัตรประชาชน :</label>
															<div class="form-group ">
																<div class="input-group">
																	<input class="form-control" type="text" name="card_person"
																		@bind-value="card_person">

																</div>
															</div>
														</div>
														<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
															<label class="form-label" for="">เบอร์โทรศัพท์ :</label>
															<div class="form-group ">
																<div class="input-group">
																	<input class="form-control" type="text" name="mem_telmobile"
																		@bind-value="mem_telmobile">
																</div>
															</div>
														</div>
														<div class="col-xl-2 col-md-6 col-sm-6 d-flex flex-column">
															<button class="btn btn-outline-secondary"
																@onclick="SearchOfGetAcc">ค้นหา</button>
														</div>
													</div>
													<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails"
														ColumnWidth="200px" AllowFiltering="true"
														FilterPopupRenderMode="PopupRenderMode.OnDemand"
														FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10"
														AllowPaging="true" AllowSorting="true"
														PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
														<Columns>
															<RadzenDataGridColumn Width="20%" TItem="Models.AccountDetails"
																Title="เลขที่บัญชี" Property="deptaccount_no">
																<Template>
																	<div @onclick="@(e => UpdateAccountDetails(context))"
																		data-bs-dismiss="modal">
																		@context.deptaccount_no
																	</div>
																</Template>
															</RadzenDataGridColumn>

															<RadzenDataGridColumn Width="30%" TItem="Models.AccountDetails"
																Title="ชื่อบัญชี" Property="deptaccount_name">
																<Template>
																	<div @onclick="@(e => UpdateAccountDetails(context))"
																		data-bs-dismiss="modal">
																		@context.deptaccount_name
																	</div>
																</Template>
															</RadzenDataGridColumn>
															<RadzenDataGridColumn Width="20%" TItem="Models.AccountDetails"
																Title="เลขสมาชิก" Property="member_no">
																<Template>
																	<div @onclick="@(e => UpdateAccountDetails(context))"
																		data-bs-dismiss="modal">
																		@context.member_no
																	</div>
																</Template>
															</RadzenDataGridColumn>
															<RadzenDataGridColumn Width="30%" TItem="Models.AccountDetails"
																Title=" ชื่อ -นามสกุล" Property="full_name">
																<Template>
																	<div @onclick="@(e => UpdateAccountDetails(context))"
																		data-bs-dismiss="modal">
																		@context.full_name
																	</div>
																</Template>
															</RadzenDataGridColumn>
														</Columns>
													</RadzenDataGrid>

												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-xl-1 col-md-2 col-sm-6 d-flex flex-column">
									@* <button type="button" class="btn btn-outline-secondary"
						@onclick="PerformSearch">ค้นหา</button> *@
									<button type="submit" class="btn btn-outline-secondary">ค้นหา</button>

								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ทำรายการ</label>
									<select id="recppaytypeSelect" name="itemtype" class="form-select">
										<option selected value="WID">(-) ถอน</option>
										<option value="CLS">(/) ปิดบัญชี</option>
									</select>
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">รายการ</label>
									<select id="recppaytypeSelect" name="recppaytype_code" class="form-select"
										@onchange="RecpPayTypeChanged">

										@if (Item.recppaytype == null || !Item.recppaytype.Any())
										{
											<option selected disabled></option>
										}
										else
										{
											<option selected disabled></option>
											@foreach (var recppaytypeItem in Item.recppaytype)
											{
												if (recppaytypeItem.recppaytype_code == Item.recppaytype_code)
												{
													isCurrentOptionSelected = true;

												}
												else
												{
													isCurrentOptionSelected = false;
												}
												if (recppaytypeItem.genvc_flag == 1)
												{
													<option
														value="@($"{recppaytypeItem.cash_type}|{recppaytypeItem.tofrom_accid}_{recppaytypeItem.recppaytype_code}_{recppaytypeItem.cash_type}")"
														selected="@isCurrentOptionSelected">
														@recppaytypeItem.recppaytype_code - @recppaytypeItem.recppaytype_desc
													</option>
												}
											}
										}

									</select>
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">เลขสมุด</label>
									<RadzenMask Mask="**********" CharacterPattern="[0-9]" readonly
										@bind-value="Item.deptpassbook_no" Name="deptaccount_no" class="form-control" />
								</div>
								<div class="col-xl-8 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ชื่อบัญชี</label>
									<RadzenTextBox class="form-control" type="text" readonly Name="deptaccount_name"
										@bind-value="Item.deptaccount_name" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ประเภทบัญชี</label>
									<RadzenTextBox class="form-control" readonly type="text" Name="depttype_code"
										@bind-value="Item.depttype_desc" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">เลขสมาชิก</label>
									<RadzenMask Mask="**********" readonly CharacterPattern="[0-9]" @bind-value="Item.member_no"
										Name="deptaccount_no" class="form-control" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">เลขบัตรประชาชน</label>
									<RadzenMask Mask="**********" readonly CharacterPattern="[0-9]" @bind-value="card_person"
										Name="deptaccount_no" class="form-control" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">วันที่</label>
									<RadzenDatePicker ReadOnly @bind-Value=@Item.operate_date Name="operate_date"
										DateFormat="dd/MM/yyyy" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ทำรายการโดย</label>
									<select class="form-select" @bind="nobook_flag" >
										<option Value="0">มีสมุด</option>
										<option Value="1">ไม่มีสมุด</option>
									</select>
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ประเภทเงิน</label>
									<input class="form-control" readonly type="text" name="cash_type"
										value="@(cashTypeValue == null ? Item.moneytype_code : cashTypeValue)" />
								</div>
								@if (cashTypeValue == "CSH")
								{
									@if (recpPayTypeCode == "WTD")
									{
										<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
											<label class="form-label" for="">รหัสคู่บัญชี</label>
											@* <select id="tofromaccSelect" class="form-select" @bind="selectedValue"> *@
											<select id="tofromaccSelect" class="form-select" value="@bookCode"
												@onchange="OnToFromAccChanged">
												@if (Item.tofromacc == null || !Item.tofromacc.Any())
												{
													<option selected disabled></option>
												}
												else
												{
													<option selected disabled>--กรุณาเลือก--</option>
													@foreach (var tofromaccItem in Item.tofromacc)
													{
														@if (tofromaccItem.cash_type == cashTypeValue)
														{
															<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																selected="@isCurrentOptionSelected">
																@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
															</option>
														}
													}
												}
											</select>
										</div>
									}
									else
									{
										<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
											<label class="form-label" for="">รหัสคู่บัญชี</label>
											@* <select id="tofromaccSelect" class="form-select" @bind="selectedValue"> *@
											<select id="tofromaccSelect" class="form-select" value="@bookCode"
												@onchange="OnToFromAccChanged">
												@if (Item.tofromacc == null || !Item.tofromacc.Any())
												{
													<option selected disabled></option>
												}
												else
												{
													<option selected disabled>--กรุณาเลือก--</option>
													@foreach (var tofromaccItem in Item.tofromacc)
													{
														@* if (tofromaccItem.tofrom_accid == Item.tofrom_accid)
							{
							isCurrentOptionSelected = true;

							}
							else
							{
							isCurrentOptionSelected = false;
							} *@
														@if (tofromaccItem.cash_type == cashTypeValue)
														{
															<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																selected="@isCurrentOptionSelected">
																@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
															</option>
														}
													}
												}
											</select>
										</div>
									}
								}
								else if (cashTypeValue == "TRN" || Item.moneytype_code == "TRN")
								{
									@if (recpPayTypeCode == "WIB")
									{
										<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
											<label class="form-label" for="">รหัสคู่บัญชี</label>
											@* <select id="tofromaccSelect" class="form-select" @bind="selectedValue"> *@
											<select id="tofromaccSelect" class="form-select" @onchange="OnToFromAccChanged">
												@if (Item.tofromacc == null || !Item.tofromacc.Any())
												{
													<option selected disabled></option>
												}
												else
												{
													<option selected disabled>--กรุณาเลือก--</option>
													@foreach (var tofromaccItem in Item.tofromacc)
													{
														isCurrentOptionSelected = true;
														@if (tofromaccItem.cash_type == cashTypeValue)
														{
															<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																selected="@isCurrentOptionSelected">
																@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
															</option>
														}

													}
												}
											</select>
										</div>
									}
									else
									{
										<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
											<label class="form-label" for="">รหัสคู่บัญชี</label>
											@* <select id="tofromaccSelect" class="form-select" @bind="selectedValue"> *@
											<select id="tofromaccSelect" class="form-select" @onchange="OnToFromAccChanged">
												@if (Item.tofromacc == null || !Item.tofromacc.Any())
												{
													<option selected disabled></option>
												}
												else
												{
													<option selected disabled>--กรุณาเลือก--</option>
													@foreach (var tofromaccItem in Item.tofromacc)
													{
														isCurrentOptionSelected = true;
														@if (tofromaccItem.cash_type == cashTypeValue)
														{
															<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																selected="@isCurrentOptionSelected">
																@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
															</option>
														}

													}
												}
											</select>
										</div>
									}
								}
								else if (cashTypeValue == "CBT" || Item.moneytype_code == "CBT" || cashTypeValue == "CHQ" ||
								Item.moneytype_code == "CHQ")
								{
									<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
										<label class="form-label" for="">ธนาคาร</label>
										<div class="form-group ">
											<div class="input-group">
												<input class="format-money form-control" type="text"
													style="text-align: center; width: 30%;" name="bank_code" value="@bank_code"
													@oninput="OnGetBankChanged" />
												<select id="getBankSelect" class="form-select" @onchange="OnGetBankSelectChanged"
													style="width: 70%;">
													<option selected disabled>--กรุณาเลือก--</option>
													@foreach (var getBankItem in getBank)
													{
														bool isCurrentOptionSelected = getBankItem.bank_code == BankValues;
														<option value="@getBankItem.bank_code" selected="@isCurrentOptionSelected">
															@getBankItem.bank_code - @getBankItem.bank_desc
														</option>
													}
												</select>
											</div>
										</div>
									</div>
									<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
										<label class="form-label" for="">สาขา</label>
										<div class="form-group ">
											<div class="input-group">
												<input class="format-money form-control" type="text"
													style="text-align: center; width: 30%;" name="bank_code" value="@bankbranch_code"
													@oninput="OnBankBranchChanged" />
												<select id="getBankSelect" class="form-select" @onchange="OnBankBranchSelectChanged"
													style="width: 70%;">
													<option selected disabled>--กรุณาเลือก--</option>
													@foreach (var bankBranchItem in bankBranch)
													{
														bool isCurrentOptionSelected = bankBranchItem.branch_id == BankBranchValues;
														<option value="@bankBranchItem.branch_id" selected="@isCurrentOptionSelected">
															@bankBranchItem.branch_id - @bankBranchItem.branch_name
														</option>
													}
												</select>
											</div>
										</div>
									</div>
									<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
										<label class="form-label" for="">เลขที่บัญชี</label>
										<input class="form-control" style="text-align: end;" type="text" Name="prncbal"
											@bind-value="check_no" />
									</div>
									<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
										<label class="form-label" for="">ชื่อบัญชี</label>
										<input class="form-control" style="text-align: end;" type="text" Name="prncbal"
											@bind-value="bankaccount_name" />
									</div>
									<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
										<label class="form-label" for="">รหัสคู่บัญชี</label>
										@* <select id="tofromaccSelect" class="form-select" @bind="selectedValue"> *@
										<select id="tofromaccSelect" class="form-select" value="@bookCode"
											@onchange="OnToFromAccChanged">
											@if (Item.tofromacc == null || !Item.tofromacc.Any())
											{
												<option selected disabled></option>
											}
											else
											{
												<option selected disabled>--กรุณาเลือก--</option>
												@foreach (var tofromaccItem in Item.tofromacc)
												{
													@* if (tofromaccItem.tofrom_accid == Item.tofrom_accid)
							{
							isCurrentOptionSelected = true;

							}
							else
							{
							isCurrentOptionSelected = false;
							} *@
													@if (tofromaccItem.cash_type == cashTypeValue)
													{
														<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
															selected="@isCurrentOptionSelected">
															@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
														</option>
													}
												}
											}
										</select>
									</div>
								}

								else
								{
									@if (Item.moneytype_code == "CSH")
									{
										<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
											<label class="form-label" for="">รหัสคู่บัญชี</label>
											@* <select id="tofromaccSelect" class="form-select" @bind="selectedValue"> *@
											<select id="tofromaccSelect" class="form-select" value="@bookCode"
												@onchange="OnToFromAccChanged">
												@if (Item.tofromacc == null || !Item.tofromacc.Any())
												{
													<option selected disabled></option>
												}
												else
												{
													<option selected disabled>--กรุณาเลือก--</option>
													@foreach (var tofromaccItem in Item.tofromacc)
													{
														isCurrentOptionSelected = true;
														@if (tofromaccItem.cash_type == Item.moneytype_code)
														{
															<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																selected="@isCurrentOptionSelected">
																@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
															</option>
														}
													}
												}
											</select>
										</div>
									}
								}

								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">คงเหลือ</label>
									<input class="form-control" style="text-align: end;" readonly type="text" Name="prncbal"
										@bind-value="Item.prncbal" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ถอนได้</label>
									<input class="form-control" style="text-align: end;" readonly type="text"
										Name="withdrawable_amt" @bind-value="Item.withdrawable_amt" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">อายัดรวม</label>
									<input class="form-control" style="text-align: end;" readonly type="text" Name="sequest_amont"
										@bind-value="sequest_amont" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">เช็คเรียกเก็บ</label>
									<input class="form-control" style="text-align: end;" readonly type="text" Name="checkpend_amt"
										@bind-value="checkpend_amt" />
								</div>
							</div>
							<div class="row">
								@* <div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
					<label class="form-label" for="">อายัดรวม</label>
					<input class="form-control" style="text-align: end;" readonly type="text" Name="sequest_amont"
					@bind-value="sequest_amont" />
					</div>
					<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
					<label class="form-label" for="">เช็คเรียกเก็บ</label>
					<input class="form-control" style="text-align: end;" readonly type="text" Name="checkpend_amt"
					@bind-value="checkpend_amt" />
					</div>
					<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
					<label class="form-label" for="">ยอดฝากได้</label>
					<input class="form-control" style="text-align: end;" type="text" Name="deptslip_amt"
					@bind-value="Item.deptslip_amt" />
					</div> *@
								<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ด/บ</label>
									<input type="text" class="format-money form-control" readonly style="text-align: end;"
										Name="int_amt" value="@(int_amt!= null ? Item.int_amt:int_amt)" placeholder="0.00"
										onblur="formattNumberr(this)" />

								</div>
								<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">โบนัส</label>
									<input type="text" class="format-money form-control" readonly style="text-align: end;"
										Name="intbonus_amt" value="@intbonus_amt" placeholder="0.00"
										onblur="formattNumberr(this)" />

								</div>
								<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ภาษี ด/บ</label>
									<input type="text" class="format-money form-control" readonly style="text-align: end;"
										Name="tax_amt" value="@(tax_amt!= null ? Item.tax_amt:tax_amt)" placeholder="0.00"
										onblur="formattNumberr(this)" />

								</div>
								<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ด/บ คืน</label>
									<input type="text" class="format-money form-control" readonly style="text-align: end;"
										Name="int_return" value="@int_return" placeholder="0.00" onblur="formattNumberr(this)" />

								</div>
								<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ภาษี คืน</label>
									<input type="text" class="format-money form-control" readonly style="text-align: end;"
										Name="tax_return" value="@tax_return" placeholder="0.00" onblur="formattNumberr(this)" />

								</div>
								<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ด/บ สุทธิ</label>
									<input type="text" class="format-money form-control" readonly style="text-align: end;"
										Name="int_netamt" value="@int_netamt" placeholder="0.00" onblur="formattNumberr(this)" />

								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ยอดทำรายการ</label>
									<div class="form-group ">
										<div class="input-group">
											@* <input type="text" class="format-money form-control" style="text-align: end;"
								Name="deptslip_netamt"
								value="@(deptslipNetamt!= null ? Item.deptslip_amt:deptslipNetamt)"
								placeholder="0.00" onblur="formattNumber(this)" /> *@
											<input type="text" class="format-money form-control" style="text-align: end;"
												@bind="DeptslipAmt" placeholder="0.00" @onblur="FormatNumber" />
											<div class="input-group-addon">
												<RadzenIcon class="icons icon-search" Icon="ballot" data-bs-toggle="modal"
													data-bs-target="#myModal1" />
											</div>
										</div>
									</div>
									<!-- The Modal -->
									<div class="modal" id="myModal1">
										<div class="modal-dialog modal-xl">
											<div class="modal-content">
												<!-- Modal Header -->
												<div class="modal-header">
													<h4 class="modal-title">ข้อมูลสมาชิก</h4>
													<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
												</div>
												<!-- Modal body -->
												<div class="modal-body">
													<div style="margin: 20px">
													</div>
													<span>
														<asp:Button ID="b_calChange" runat="server"
															Style="float: left; width: 100%; height: 25px" Text="คำนวณเงินทอน"
															TabIndex="12" BackColor="#556B2F" ForeColor="White" />
													</span>

													<!-- Modal footer -->
													<div class="modal-footer">
														<button type="button" class="btn btn-danger"
															data-bs-dismiss="modal">Close</button>
													</div>

												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">เพื่อ</label>
									<RadzenTextBox class="form-control" type="text" readonly Name="dept_objective"
										@bind-value="Item.dept_objective" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ยอดในสมุด</label>
									<RadzenTextBox class="form-control" type="text" readonly Name="dept_objective"
										@bind-value="Item.dept_objective" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">ยอดสุทธิ</label>
									<input class="format-money form-control" placeholder="0.00" type="text"
										style="text-align: end; font-size: 32px;" readonly name="deptslip_netamt"
										@bind="DeptslipAmt" id="showNumber" />
								</div>
								<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
									<label class="form-label" for="">เงื่อนไขการถอน</label>
									<textarea class="form-control " readonly @bind="Item.condforwithdraw" name="condforwithdraw"
										id="" cols="30" rows="2"></textarea>
								</div>
							</div>
						</div>
						@if (recpPayTypeCode == "DEN")
						{

							<div class="row mt-5">
								<div class="col-12">
									<div class="row">
										<div class="col-2" style="text-align: end;">
											<h4>รายการเช็ค:</h4>
										</div>
										<div class="col-4"><button class="btn btn-outline-primary" style="border: solid 1px #d1d1d1;"
												@onclick="AddRow">เพิ่มแถว</button></div>
									</div>
								</div>
								<div class=" mt-1">
									<div class="row mt-2">
										<div class="col-12">
											<table class="table table-bordered" style="width: 100%;">
												<thead>
													<tr>
														<th style="text-align: center;width:10%;background-color: rgb(166, 207, 243);">
															เลขที่เช็ค
														</th>
														<th style="text-align: center;width:13%;background-color: rgb(166, 207, 243);">
															วันที่หน้าchq
														</th>
														<th style="text-align: center;width:8%;background-color: rgb(166, 207, 243);">
															รหัส
														</th>
														<th style="text-align: center;width:20%;background-color: rgb(166, 207, 243);">
															ธนาคาร </th>
														<th style="text-align: center;width:8%;background-color: rgb(166, 207, 243);">
															รหัส
														</th>
														<th style="text-align: center;width:20%;background-color: rgb(166, 207, 243);">
															สาขา
														</th>
														<th style="text-align: center;width:3%;background-color: rgb(166, 207, 243);">
														</th>
														<th style="text-align: center;width:15%;background-color: rgb(166, 207, 243);">
															จำนวนเงิน
														</th>
														<th style="text-align: center;width:3%;background-color: rgb(166, 207, 243);">ลบ
														</th>
													</tr>
												</thead>
												<tbody>
													@if (rows != null && rows.Count > 0)
													{
														@foreach (var row in rows)
														@* @for (var index = 0; index < rows.Count; index++) *@
														{
															<tr>
																<td><input class="form-control"
																		style="width:100%;text-align: center; border: solid 1px #fff;"
																		placeholder="0" type="text" @bind="row.cheque_no" /></td>
																<td>
																	<RadzenDatePicker class="inputrPicker" @bind-Value=row.cheque_date
																		Name="operate_date" DateFormat="dd/MM/yyyy" />
																</td>
																<td>
																	<input class="form-control"
																		style="width:100%;text-align: center; border: solid 1px #fff;"
																		type="text" @bind-value="row.bank_code" @oninput="OnGetBankChanged" />
																</td>
																<td>
																	<select id="getBankSelect" class="form-select"
																		@onchange="OnGetBankSelectChanged">
																		<option selected disabled>--กรุณาเลือก--</option>
																		@foreach (var getBankItem in getBank)
																		{
																			bool isCurrentOptionSelected = getBankItem.bank_code == row.bank_code;
																			<option value="@getBankItem.bank_code"
																				selected="@isCurrentOptionSelected">
																				@getBankItem.bank_code - @getBankItem.bank_desc
																			</option>
																		}
																	</select>
																	@* <RadzenDropDown @ref="radzenDropDown" @bind-SearchText="searchText"
											FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
											FilterOperator="StringFilterOperator.StartsWith" AllowFiltering="true"
											Data="@getBank" TextProperty="bank_desc" ValueProperty="bank_code"
											AllowClear="true" @bind-Value="selectedCustomer"
											Style="width: 100%; max-width: 400px;" /> *@

																</td>

																<td>
																	<input class="form-control"
																		style="width:100%;text-align: center; border: solid 1px #fff;"
																		type="text" @bind="row.branch_id" />

																</td>
																<td>
																	<select class="form-select">
																		<option selected disabled>--กรุณาเลือก--</option>
																		@foreach (var bankBranchItem in bankBranch)
																		{
																			bool isCurrentOptionSelected = bankBranchItem.branch_id ==
																			row.branch_id;
																			<option value="@bankBranchItem.branch_id"
																				selected="@isCurrentOptionSelected">
																				@bankBranchItem.branch_id - @bankBranchItem.branch_name
																			</option>
																		}
																	</select>
																</td>
																<td>
																	<RadzenIcon style="width:100%" class="icons icon-search" Icon="ballot"
																		data-bs-toggle="modal" data-bs-target="#myModal1" />
																</td>
																<td><input class="form-control"
																		style="width:100%;text-align: end;border: solid 1px #fff;"
																		placeholder="0.00" onblur="formattNumberr(this)" type="text"
																		@bind="row.cheque_amt" /></td>
																<td style="width:100%">
																	<button class="btn btn-outline-danger"
																		@onclick="() => RemoveRow(row)">ลบ</button>
																</td>
															</tr>
														}
													}
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						}
					}
				</form>
			</div>
		</div>
		<div class="card mt-4" hidden>
			<div class="row mt-2"
				style="margin-left: calc(var(--bs-gutter-x) * .5);margin-right: calc(var(--bs-gutter-x) * .5);margin-bottom: 15px;">
				<RadzenTabs @bind-SelectedIndex=@selectedIndex>
					<Tabs>
						<RadzenTabsItem Text="รายละเอียดต้นเงิน">
							<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails" ColumnWidth="200px"
								AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand"
								FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10" AllowPaging="true"
								AllowSorting="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
								<Columns>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ต้นเงิน" Property="prnc_no">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ต้นเงินคงเหลือ"
										Property="prnc_bal">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ยอดเงินทำรายการ"
										Property="prncslip_amt">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันที่ต้นเงิน"
										Property="prnc_date">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันครบกำหนด"
										Property="prncdue_date">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันเริ่มคิดด/บถึง"
										Property="calint_from">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ด/บ จ่าย" Property="calint_to">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ภาษี" Property="intpay_amt">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ด/บ.หลังหักภาษี"
										Property="taxpay_amt">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ด/บค้าง" Property="intslip_net">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ค่าปรับ"
										Property="intbf_accyear">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ด/บ เรียกคืน"
										Property="int_return">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ภาษี เรียกคืน"
										Property="tax_return">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="อัตราดอกเบี้ย"
										Property="interest_rate">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="จำนวนวัน" Property="day_cal">
									</RadzenDataGridColumn>
								</Columns>
							</RadzenDataGrid>
						</RadzenTabsItem>
						<RadzenTabsItem Text="ลายเซ็น">
							ลายเซ็น
						</RadzenTabsItem>
						<RadzenTabsItem Text="ผู้ฝากร่วม">
							<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails" ColumnWidth="200px"
								AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand"
								FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10" AllowPaging="true"
								AllowSorting="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
								<Columns>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ลำดับ" Property="prnc_no">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="เลขอ้างอิง" Property="prnc_bal">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ชื่อ - นามสกุล"
										Property="prncslip_amt">
									</RadzenDataGridColumn>
								</Columns>
							</RadzenDataGrid>
						</RadzenTabsItem>
						<RadzenTabsItem Text="การอายัดบัญชี">
							<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails" ColumnWidth="200px"
								AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand"
								FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10" AllowPaging="true"
								AllowSorting="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
								<Columns>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ลำดับ" Property="prnc_no">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันที่เริ่มต้น	"
										Property="prnc_bal">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันที่สิ้นสุด	"
										Property="prncslip_amt">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="รายการ" Property="prnc_date">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="สาเหตุการอายัด"
										Property="prncdue_date">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ยอดเงิน" Property="calint_from">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ผู้ทำรายการ"
										Property="calint_to">
									</RadzenDataGridColumn>
									<RadzenDataGridColumn TItem="Models.AccountDetails" Title="หมายเหตุ" Property="intpay_amt">
									</RadzenDataGridColumn>
								</Columns>
							</RadzenDataGrid>
						</RadzenTabsItem>
					</Tabs>
				</RadzenTabs>
			</div>
		</div>
	}


	 public async Task<LoginResult> Login(string user_name, string password, string selectedDatabase)
    {
        var ip = _accessor.HttpContext?.Connection?.RemoteIpAddress?.ToString();
        var userAgent = _accessor.HttpContext.Request.Headers["User-Agent"];
        var payload = new
        {
            coop_control = selectedDatabase == "1" ? "065001" : "079001",
            coop_id = selectedDatabase == "1" ? "065001" : "079001",
            user_name = user_name,
            password = password,
            base_id = selectedDatabase,
        };
        var reqUrl = ApiClient.Paths.UserLogin;
        var json = JsonConvert.SerializeObject(payload);
        Console.WriteLine($"reqUrl:{reqUrl}");
        Console.WriteLine($"payload content :{json}");
        var response = await _apiProvider.PostAsync(reqUrl, payload);
        Console.WriteLine($"presponse:{response}");

        Console.WriteLine($"response.IsSuccessStatusCode :{response.IsSuccessStatusCode}");

        if (response.IsSuccessStatusCode)
        {
            var jsonResponse = await response.Content.ReadAsStringAsync();
            var loginResponse = JsonConvert.DeserializeObject<LoginResult>(jsonResponse);
            Console.WriteLine($"isSuccess: {loginResponse.Success}");
            _state.SetAmsecUseappss((List<AmsecUseappss>)loginResponse.Content.Content);
            if (loginResponse != null)
            {
                if (loginResponse.Success)
                {
                    Console.WriteLine($"isSuccess: {loginResponse.Success}");
                    Console.WriteLine($"message: {loginResponse.Message}");
                    Console.WriteLine($"accessToken: {loginResponse.Content.AccessToken}");
                    Console.WriteLine($"refreshToken: {loginResponse.Content.RefreshToken}");
                    Console.WriteLine($"AmsecUseappss: {loginResponse.Content.Content}");
                    return new LoginResult
                    {
                        Success = true,
                        accessToken = loginResponse.Content.AccessToken,
                        refreshToken = loginResponse.Content.RefreshToken,
                        amsecUseappss = (List<AmsecUseappss>)loginResponse.Content.Content,
                    };
