@* @page "/dept/dep_withdraw" *@
@page "/ws_dep_slip_withdraw"
@using Newtonsoft.Json
@using Radzen.Blazor
@using System.Runtime.InteropServices.JavaScript
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.JSInterop
@inject IJSRuntime jsRuntime
@inject HttpClient httpClient
@using System.Linq.Dynamic.Core
@inject NotificationService NotificationService
@using System.Globalization
@using System.Text.Json
@using System.ComponentModel
@using System.ComponentModel.DataAnnotations
@inject Services.Api_Provider ApiProvider


<style>
	.icon-search {
		display: inline-flex !important;
		justify-content: space-evenly !important;
		align-items: center !important;
		position: relative !important;
		top: 3px !important;
		padding: 15px !important;
		flex-wrap: nowrap !important;
	}

	.table>:not(caption)>*>* {
		padding: 0.2rem 0.2rem;
	}

	.save_top {
		border: #adacac solid 1px;
	}

	.header-right {
		text-align: start;
	}

	.header-left {
		text-align: end;
	}

	.card {
		background-color: #f9f9f9;
	}

	.rz-calendar .rz-inputtext {
		background-color: #e9ecef;
		opacity: 1;
	}
	.label-group {
		margin-left: 10px;
	}
	@* .rz-grid-table{
		width: 170pc;
	} *@
	.grid-table {
    position: relative;
    border-collapse: separate;
    border-spacing: 0;
	width:2000px !important;
	}
	.rz-selectable tbody tr.rz-data-row.rz-state-highlight > td {
     background-color: transparent !important; 
}
</style>
<div class="header-page">
	<div class="row-header d-flex justify-content-between ">
		<div class="header-left">
			<h4>ระบบ เงินฝาก - ถอนเงิน/ปิดบัญชี</h4>
		</div>
		@* <div class="header-right">
			<RadzenButton class="save_top" Icon="save" Text="Save" Click="@SaveDataAsync" />
		</div> *@
		<div class="header-right">
			@if (currentStep != 2)
			{
				<RadzenButton class="save_top" Icon="save" Text="@((saveLoading ? "Saving..." : "Save"))" Click="@SaveDataAsync"
							  Disabled="@(!IsSaveEnabled)" />
			}
			else if (currentStep == 2)
			{
				<RadzenButton class="save_top" Icon="print" Text="@((saveLoading ? "พิมพ์..." : "พิมพ์"))" Click="@PrintPdf"
							  Disabled="@(!success_status)" />
			}
			<RadzenButton class="save_top" Icon="CalIntPrncfix" Text="พิมพ์" Click="@CalIntPrncfix" />
		</div>
	</div>
</div>
@* @if (isLoading)
{ *@
	@* <div
		style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex;background-color: #e9e9e9;opacity: 50%; justify-content: center; align-items: center; z-index: 90;">
		<div class="spinner-border text-primary" role="status">
			<span class="visually-hidden">Loading...</span>
		</div>
	</div> *@
	@* <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex;background-color: #e9e9e9;opacity: 25%; justify-content: center; align-items: center; z-index: 90;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div> *@
@* }
else
{ *@
	<div class="card body-page">
		<div class="row mt-2" style="margin-left: calc(var(--bs-gutter-x) * .1);margin-bottom: 15px;">
			<RadzenSteps @bind-SelectedIndex="currentStep" Change="@OnChange">
				<Steps>
					<RadzenStepsItem Disabled="@(currentStep == 2)" @bind-SelectedIndex="currentStep" Text="ทำรายการ" @onkeydown="OnKeyDownAsync">
						<RadzenRow>
							<RadzenText Text="ทำรายการ" />
						</RadzenRow>
						@if (datadetail == null)
						{
							<div class="row"@onkeydown="OnKeyDownAsync" tabindex="0" style="margin-left: calc(var(--bs-gutter-x) * -.21)">
								@* <form @onsubmit="PerformSearch"> *@
									<div class="row">
										<div class="col-xl-4 col-md-4 col-sm-6 d-flex flex-column">
											<label class="form-label" for="">เลขที่บัญชี</label>
											<div class="form-group ">
												<div class="input-group">
													<RadzenMask Mask="**-********" CharacterPattern="[0-9]" @bind-value="deptno_format"
																Name="deptaccount_no" class="form-control" @onkeydown="@HandleEnterKeyPress" />
													<div class="input-group-addon">
														<RadzenIcon class="icons icon-search" @onclick="GetDeptMaintype" Icon="ballot"
																	data-bs-toggle="modal" data-bs-target="#ModalSearch" />
													</div>
												</div>
											</div>
											<div class="modal" tabindex="-1" id="ModalSearch">
												<div class="modal-dialog modal-xl">
													<div class="modal-content">
														<!-- Modal Header -->
														<div class="modal-header">
															<h4 class="modal-title">ข้อมูลสมาชิก</h4>
															<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
														</div>
														<!-- Modal body -->
														<div class="modal-body">
															<div class="row" style="margin-left:-4px;margin-right:-4px;">
																<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																	<label class="form-label" for="">ประเภทบัญชี</label>
																	@if (getDeptMaintype != null)
																	{
																		<select id="DeptMaintype" name="DeptMaintype" class="form-select"
																		@onchange="DeptMaintype">
																			<option value="null" selected>--กรุณาเลือก--</option>
																			@foreach (var MaintypeItem in getDeptMaintype)
																			{
																				<option value="@MaintypeItem.deptmain_type">
																					@MaintypeItem.deptmain_type - @MaintypeItem.deptmain_desc
																				</option>
																			}
																		</select>
																	}
																</div>
																<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																	<label class="form-label" for="">เลขที่บัญชี</label>
																	<div class="form-group ">
																		<div class="input-group">
																			<RadzenMask Mask="**-********" CharacterPattern="[0-9]"
																			@bind-value="deptaccount_No_fild" Name="deptaccount_No_fild"
																						class="form-control" />

																		</div>
																	</div>
																</div>
																<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																	<label class="form-label" for="">ชื่อบัญชี :</label>
																	<div class="form-group ">
																		<div class="input-group">
																			<input class="form-control" type="text" name="deptaccount_name_fild"
																			@bind-value="deptaccount_name_fild">

																		</div>
																	</div>
																</div>
																<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																	<label class="form-label" for="">สถานะบัญชี</label>
																	<select class="form-select" @bind="deptclose_status">
																		<option Value="0">เปิดบัญชี</option>
																		<option Value="1">ปิดบัญชี</option>
																	</select>
																</div>
																<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																	<label class="form-label" for="">เลขที่สมาชิก</label>
																	<div class="form-group ">
																		<div class="input-group">
																			<input class="form-control" type="text" name="memb_name"
																			@bind-value="member_no">

																		</div>
																	</div>
																</div>
																<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																	<label class="form-label" for="">เลขพนักงาน</label>
																	<div class="form-group ">
																		<div class="input-group">
																			<input class="form-control" type="text" name="salary_id"
																			@bind-value="salary_id">
																		</div>
																	</div>
																</div>
																<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																	<label class="form-label" for="">ชื่อ</label>
																	<div class="form-group ">
																		<div class="input-group">
																			<input class="form-control" type="text" name="memb_name"
																			@bind-value="memb_name">

																		</div>
																	</div>
																</div>
																<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																	<label class="form-label" for="">นามสกุล</label>
																	<div class="form-group ">
																		<div class="input-group">
																			<input class="form-control" type="text" name="memb_surname"
																			@bind-value="memb_surname">
																		</div>
																	</div>
																</div>
																<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																	<label class="form-label" for="">บัตรประชาชน :</label>
																	<div class="form-group ">
																		<div class="input-group">
																			<input class="form-control" type="text" name="card_person"
																			@bind-value="card_person">

																		</div>
																	</div>
																</div>
																<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																	<label class="form-label" for="">เบอร์โทรศัพท์ :</label>
																	<div class="form-group ">
																		<div class="input-group">
																			<input class="form-control" type="text" name="mem_telmobile"
																			@bind-value="mem_telmobile">
																		</div>
																	</div>
																</div>
																<div class="col-xl-2 col-md-6 col-sm-6 d-flex flex-column">
																	<button class="btn btn-outline-secondary"
																	@onclick="SearchOfGetAcc">
																		ค้นหา
																	</button>
																</div>
															</div>
															<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails"
																			ColumnWidth="100%" AllowFiltering="true"
																			FilterPopupRenderMode="PopupRenderMode.OnDemand"
																			FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10"
																			AllowPaging="true" AllowSorting="true"
																			PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
																<Columns>
																	<RadzenDataGridColumn Width="20%" TItem="Models.AccountDetails"
																						  Title="เลขที่บัญชี" Property="deptaccount_no">
																		<Template>
																			<div @onclick="@(e => UpdateAccountDetails(context))"
																				 data-bs-dismiss="modal">
																				@context.deptaccount_no
																			</div>
																		</Template>
																	</RadzenDataGridColumn>

																	<RadzenDataGridColumn Width="30%" TItem="Models.AccountDetails"
																						  Title="ชื่อบัญชี" Property="deptaccount_name">
																		<Template>
																			<div @onclick="@(e => UpdateAccountDetails(context))"
																				 data-bs-dismiss="modal">
																				@context.deptaccount_name
																			</div>
																		</Template>
																	</RadzenDataGridColumn>
																	<RadzenDataGridColumn Width="20%" TItem="Models.AccountDetails"
																						  Title="เลขสมาชิก" Property="member_no">
																		<Template>
																			<div @onclick="@(e => UpdateAccountDetails(context))"
																				 data-bs-dismiss="modal">
																				@context.member_no
																			</div>
																		</Template>
																	</RadzenDataGridColumn>
																	<RadzenDataGridColumn Width="30%" TItem="Models.AccountDetails"
																						  Title=" ชื่อ -นามสกุล" Property="full_name">
																		<Template>
																			<div @onclick="@(e => UpdateAccountDetails(context))"
																				 data-bs-dismiss="modal">
																				@context.full_name
																			</div>
																		</Template>
																	</RadzenDataGridColumn>
																</Columns>
															</RadzenDataGrid>

														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="col-xl-1 col-md-2 col-sm-6 d-flex flex-column">
											<button type="button" class="btn btn-outline-secondary" @onclick="PerformSearch">
											  @if (isLoading)
													{
														<span>...</span>
														<i class="fa fa-spinner fa-spin"></i>
													}
													else
													{
														<span>ค้นหา</span>
													}
													</button>
											@* <button type="submit" class="btn btn-outline-secondary">ค้นหา</button> *@
										</div>
										@* <div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
											<label class="form-label" for="">ทำรายการ</label>
											<select id="recppaytypeSelect"  @onchange="TypeChanged" name="itemtype" class="form-select">
												<option value="WID" >(-) ถอน</option>
												<option value="CLS ">(/) ปิดบัญชี</option>
											</select>
										</div> *@
									</div>
								@* </form> *@
							</div>
						}
						else
						{
							@* <form @onsubmit="PerformSearch"> *@
								@foreach (var item in datadetail)
								{
									var Item = item.deptSlip;
									var withdrawable_amt = Item.withdrawable_amt?.ToString("N2");
									var prncbal = Item.prncbal?.ToString("N2");
									<div class="row"  @onkeydown="OnKeyDownAsync" tabindex="0" style="margin-left: calc(var(--bs-gutter-x) * -.21);margin-bottom: 15px;">
										<div class="row">
											<div class="col-xl-3 col-md-4 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">เลขที่บัญชี</label>
												<div class="form-group ">
													<div class="input-group">
														@* <input class="form-control" type="text" name="deptaccount_no" @bind="deptaccount_no">
											*@
														<RadzenMask Mask="**-********" CharacterPattern="[0-9]" @bind-value="deptno_format"
																	Name="deptaccount_no" class="form-control" @onkeydown="@HandleEnterKeyPress" />
														<div class="input-group-addon">
															<RadzenIcon class="icons icon-search" @onclick="GetDeptMaintype" Icon="ballot"
																		data-bs-toggle="modal" data-bs-target="#anotherModal" />
														</div>
													</div>
												</div>
												<div class="modal" tabindex="-1" id="anotherModal">
													<div class="modal-dialog modal-xl">
														<div class="modal-content">
															<!-- Modal Header -->
															<div class="modal-header">
																<h4 class="modal-title">ข้อมูลสมาชิก</h4>
																<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
															</div>
															<!-- Modal body -->
															<div class="modal-body">
																<div class="row" style="margin-left:-4px;margin-right:-4px;">
																	<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																		<label class="form-label" for="">ประเภทบัญชี</label>
																		@if (getDeptMaintype != null)
																		{
																			<select id="DeptMaintype" name="DeptMaintype" class="form-select"
																			@onchange="DeptMaintype">
																				<option value="null" selected>--กรุณาเลือก--</option>
																				@foreach (var MaintypeItem in getDeptMaintype)
																				{
																					<option value="@MaintypeItem.deptmain_type">
																						@MaintypeItem.deptmain_type - @MaintypeItem.deptmain_desc
																					</option>
																				}
																			</select>
																		}
																	</div>
																	<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																		<label class="form-label" for="">เลขที่บัญชี</label>
																		<div class="form-group ">
																			<div class="input-group">
																				<RadzenMask Mask="**-********" CharacterPattern="[0-9]"
																				@bind-value="deptaccount_No_fild" Name="deptaccount_no"
																							class="form-control" />

																			</div>
																		</div>
																	</div>
																	<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																		<label class="form-label" for="">ชื่อบัญชี :</label>
																		<div class="form-group ">
																			<div class="input-group">
																				<input class="form-control" type="text" name="emp_name"
																				@bind-value="deptaccount_name_fild">

																			</div>
																		</div>
																	</div>
																	<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																		<label class="form-label" for="">สถานะบัญชี</label>
																		<select class="form-select" @bind="deptclose_status"
																				>
																			<option Value="0">เปิดบัญชี</option>
																			<option Value="1">ปิดบัญชี</option>
																		</select>
																	</div>
																	<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																		<label class="form-label" for="">เลขที่สมาชิก</label>
																		<div class="form-group ">
																			<div class="input-group">
																				<input class="form-control" type="text" name="memb_name"
																				@bind-value="member_no">

																			</div>
																		</div>
																	</div>
																	<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																		<label class="form-label" for="">เลขพนักงาน</label>
																		<div class="form-group ">
																			<div class="input-group">
																				<input class="form-control" type="text" name="salary_id"
																				@bind-value="salary_id">
																			</div>
																		</div>
																	</div>
																	<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																		<label class="form-label" for="">ชื่อ</label>
																		<div class="form-group ">
																			<div class="input-group">
																				<input class="form-control" type="text" name="memb_name"
																				@bind-value="memb_name">

																			</div>
																		</div>
																	</div>
																	<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																		<label class="form-label" for="">นามสกุล</label>
																		<div class="form-group ">
																			<div class="input-group">
																				<input class="form-control" type="text" name="memb_surname"
																				@bind-value="memb_surname">
																			</div>
																		</div>
																	</div>
																	<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																		<label class="form-label" for="">บัตรประชาชน :</label>
																		<div class="form-group ">
																			<div class="input-group">
																				<input class="form-control" type="text" name="card_person"
																				@bind-value="card_person">

																			</div>
																		</div>
																	</div>
																	<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
																		<label class="form-label" for="">เบอร์โทรศัพท์ :</label>
																		<div class="form-group ">
																			<div class="input-group">
																				<input class="form-control" type="text" name="mem_telmobile"
																				@bind-value="mem_telmobile">
																			</div>
																		</div>
																	</div>
																	<div class="col-xl-2 col-md-6 col-sm-6 d-flex flex-column">
																		<button class="btn btn-outline-secondary"
																		@onclick="SearchOfGetAcc">
																			ค้นหา
																		</button>
																	</div>
																</div>
																<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails"
																				ColumnWidth="100%" AllowFiltering="true"
																				FilterPopupRenderMode="PopupRenderMode.OnDemand"
																				FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10"
																				AllowPaging="true" AllowSorting="true"
																				PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
																	<Columns>
																		<RadzenDataGridColumn Width="20%" TItem="Models.AccountDetails"
																							  Title="เลขที่บัญชี" Property="deptaccount_no">
																			<Template>
																				<div @onclick="@(e => UpdateAccountDetails(context))"
																					 data-bs-dismiss="modal">
																					@context.deptaccount_no
																				</div>
																			</Template>
																		</RadzenDataGridColumn>

																		<RadzenDataGridColumn Width="30%" TItem="Models.AccountDetails"
																							  Title="ชื่อบัญชี" Property="deptaccount_name">
																			<Template>
																				<div @onclick="@(e => UpdateAccountDetails(context))"
																					 data-bs-dismiss="modal">
																					@context.deptaccount_name
																				</div>
																			</Template>
																		</RadzenDataGridColumn>
																		<RadzenDataGridColumn Width="20%" TItem="Models.AccountDetails"
																							  Title="เลขสมาชิก" Property="member_no">
																			<Template>
																				<div @onclick="@(e => UpdateAccountDetails(context))"
																					 data-bs-dismiss="modal">
																					@context.member_no
																				</div>
																			</Template>
																		</RadzenDataGridColumn>
																		<RadzenDataGridColumn Width="30%" TItem="Models.AccountDetails"
																							  Title=" ชื่อ -นามสกุล" Property="full_name">
																			<Template>
																				<div @onclick="@(e => UpdateAccountDetails(context))"
																					 data-bs-dismiss="modal">
																					@context.full_name
																				</div>
																			</Template>
																		</RadzenDataGridColumn>
																	</Columns>
																</RadzenDataGrid>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="col-xl-1 col-md-2 col-sm-6 d-flex flex-column">
												<button type="button" class="btn btn-outline-secondary" @onclick="PerformSearch">
											  @if (isLoading)
													{
														<span>...</span>
														<i class="fa fa-spinner fa-spin"></i>
													}
													else
													{
														<span>ค้นหา</span>
													}
													</button>
												@* <button type="button" class="btn btn-outline-secondary" @onclick="PerformSearch">ค้นหา</button> *@
											</div>
											@* <div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ทำรายการ</label>
												<select id="recppaytypeSelect"  @onchange="TypeChanged" name="itemtype" class="form-select">
													<option value="WID" selected="@(deptitem_group == "WID")">(-) ถอน</option>
													<option value="CLS" selected="@(deptitem_group == "CLS")">(/) ปิดบัญชี</option>
												</select>
											</div> *@
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">รายการ</label>
												@* <select id="recppaytypeSelect" name="recppaytype_code" class="form-select"
												@onchange="RecpPayTypeChanged">

													@if (Item.recppaytype == null || !Item.recppaytype.Any())
													{
														<option selected disabled></option>
													}
													else
													{
														<option selected disabled></option>
														@foreach (var recppaytypeItem in Item.recppaytype)
														{
															if (recppaytypeItem.recppaytype_code == Item.recppaytype_code)
															{
																isCurrentOptionSelected = true;

															}
															else
															{
																isCurrentOptionSelected = false;
															}
															if (recppaytypeItem.genvc_flag == 1)
															{
																<option value="@($"{recppaytypeItem.cash_type}|{recppaytypeItem.tofrom_accid}_{recppaytypeItem.recppaytype_code}_{recppaytypeItem.recppaytype_desc}")"
																		selected="@isCurrentOptionSelected">
																	@recppaytypeItem.recppaytype_code - @recppaytypeItem.recppaytype_desc
																</option>
															}
														}
													}

												</select> *@
												<select id="recppaytypeSelect" name="recppaytype_code" class="form-select"
												@onchange="RecpPayTypeChanged">

													@if (Item.recppaytype == null || !Item.recppaytype.Any())
													{
														<option selected disabled></option>
													}
													else
													{
														@foreach (var recppaytypeItem in Item.recppaytype)
														{
															isCurrentOptionSelected = (recppaytypeItem.recppaytype_code == Item.recppaytype_code || recppaytypeItem.recppaytype_code == recpPayTypeCode);
															if (recppaytypeItem.genvc_flag == 1)
															{
																<option value="@($"{recppaytypeItem.cash_type}|{recppaytypeItem.tofrom_accid}_{recppaytypeItem.recppaytype_code}_{recppaytypeItem.cash_type}_{recppaytypeItem.recppaytype_desc}")"
																		selected="@isCurrentOptionSelected">
																	@recppaytypeItem.recppaytype_code - @recppaytypeItem.recppaytype_desc
																</option>
															}
														}
													}

												</select>
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														@* <select id="tofromaccSelect" class="form-select" value="@bookCode"
														@onchange="OnToFromAccChanged"> *@
														<select id="tofromaccSelect" class="form-select" value="@bookCode" @onchange="OnToFromAccChanged">
															@if (Item.tofromacc == null || !Item.tofromacc.Any())
															{
																<option selected disabled>--กรุณาเลือก--</option>
															}
															else
															{
																<option selected disabled>--กรุณาเลือก--</option>
																@foreach (var tofromaccItem in Item.tofromacc)
																{
																	bool isCashTypeSelected = (tofromaccItem.cash_type == cashTypeValue);
																	bool isItemAccIdSelected = (tofromaccItem.cash_type == Item.moneytype_code);
																	bool isCurrentOptionSelected = (tofromaccItem.tofrom_accid == valuetoFromaccId);
																	if (isCashTypeSelected)
																	{
																		// เลือก <option> เมื่อ isCashTypeSelected เป็น true
																		if (valuetoFromaccId == null|| toFromaccId2 == null)
																		{
																			<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																					selected="@isCurrentOptionSelected">
																				@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																			</option>
																		}
																		else
																		{
																			<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																					selected="@isCurrentOptionSelected">
																				@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																			</option>
																		}
																	}
																	else if (isItemAccIdSelected)
																	{
																		// เลือก <option> เมื่อ isItemAccIdSelected เป็น true
																		if (valuetoFromaccId == null|| toFromaccId2 == null)
																		{
																			<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																					selected="@isItemAccIdSelected">
																				@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																			</option>
																		}
																	}
																}
															}
														</select>
													</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">เลขสมุด</label>
												<RadzenMask Mask="**********" CharacterPattern="[0-9]" readonly
												@bind-value="Item.deptpassbook_no" Name="deptaccount_no" class="form-control" />
											</div>
											<div class="col-xl-8 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ชื่อบัญชี</label>
												<RadzenTextBox class="form-control" type="text" readonly Name="deptaccount_name"
												@bind-value="Item.deptaccount_name" />
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ประเภทบัญชี</label>
												<RadzenTextBox class="form-control" readonly type="text" Name="depttype_code"
												@bind-value="Item.depttype_desc" />
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">เลขสมาชิก</label>
												<RadzenMask Mask="**********" readonly CharacterPattern="[0-9]" @bind-value="Item.member_no"
															Name="deptaccount_no" class="form-control" />
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">เลขบัตรประชาชน</label>
												<RadzenMask Mask="**********" readonly CharacterPattern="[0-9]" @bind-value="card_person"
															Name="deptaccount_no" class="form-control" />
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">วันที่</label>
												<RadzenDatePicker ReadOnly @bind-Value=@Item.operate_date Name="operate_date"
																	  DateFormat="dd/MM/yyyy" />
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ทำรายการโดย</label>
													<select class="form-select" @bind="nobook_flag" >
														<option Value="0">มีสมุด</option>
														<option Value="1">ไม่มีสมุด</option>
													</select>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ประเภทเงิน</label>
													<input class="form-control" readonly type="text" name="cash_type"
														   value="@(cashTypeValue == null ? Item.moneytype_code : cashTypeValue)" />
												</div>
												 @if (cashTypeValue == "CSH")
											{
												@* @if (recpPayTypeCode == "WTD")
												{
													<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														<select id="tofromaccSelect" class="form-select" value="@bookCode"
														@onchange="OnToFromAccChanged">
															@if (Item.tofromacc == null || !Item.tofromacc.Any())
															{
																<option selected disabled></option>
															}
															else
															{
																<option selected disabled>--กรุณาเลือก--</option>
																@foreach (var tofromaccItem in Item.tofromacc)
																{
																	@if (tofromaccItem.cash_type == cashTypeValue)
																	{
																		<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																				selected="@isCurrentOptionSelected">
																			@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																		</option>
																	}
																}
															}
														</select>
													</div>
												}
												else
												{
													<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														<select id="tofromaccSelect" class="form-select" value="@bookCode"
														@onchange="OnToFromAccChanged">
															@if (Item.tofromacc == null || !Item.tofromacc.Any())
															{
																<option selected disabled></option>
															}
															else
															{
																<option selected disabled>--กรุณาเลือก--</option>
																@foreach (var tofromaccItem in Item.tofromacc)
																{
																	@if (tofromaccItem.cash_type == cashTypeValue)
																	{
																		<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																				selected="@isCurrentOptionSelected">
																			@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																		</option>
																	}
																}
															}
														</select>
													</div>
												} *@
											}
											else if (cashTypeValue == "TRN" || Item.moneytype_code == "TRN")
											{
												@* @if (recpPayTypeCode == "WIB")
												{
													<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														<select id="tofromaccSelect" class="form-select" @onchange="OnToFromAccChanged">
															@if (Item.tofromacc == null || !Item.tofromacc.Any())
															{
																<option selected disabled></option>
															}
															else
															{
																<option selected disabled>--กรุณาเลือก--</option>
																@foreach (var tofromaccItem in Item.tofromacc)
																{
																	isCurrentOptionSelected = true;
																	@if (tofromaccItem.cash_type == cashTypeValue)
																	{
																		<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																				selected="@isCurrentOptionSelected">
																			@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																		</option>
																	}

																}
															}
														</select>
													</div>
												}
												else
												{
													<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														<select id="tofromaccSelect" class="form-select" @onchange="OnToFromAccChanged">
															@if (Item.tofromacc == null || !Item.tofromacc.Any())
															{
																<option selected disabled></option>
															}
															else
															{
																<option selected disabled>--กรุณาเลือก--</option>
																@foreach (var tofromaccItem in Item.tofromacc)
																{
																	isCurrentOptionSelected = true;
																	@if (tofromaccItem.cash_type == cashTypeValue)
																	{
																		<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																				selected="@isCurrentOptionSelected">
																			@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																		</option>
																	}

																}
															}
														</select>
													</div>
												} *@
											}
											else if (cashTypeValue == "CBT" || Item.moneytype_code == "CBT" || cashTypeValue == "CHQ" ||
											Item.moneytype_code == "CHQ")
											{
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ธนาคาร</label>
													<div class="form-group ">
														<div class="input-group">
															<input class="format-money form-control" type="text"
																   style="text-align: center; width: 30%;" name="bank_code" value="@bank_code"
															@oninput="OnGetBankChanged" />
															<select id="getBankSelect" class="form-select" @onchange="OnGetBankSelectChanged"
																	style="width: 70%;">
																<option selected disabled>--กรุณาเลือก--</option>
																@foreach (var getBankItem in getBank)
																{
																	bool isCurrentOptionSelected = getBankItem.bank_code == BankValues;
																	<option value="@getBankItem.bank_code" selected="@isCurrentOptionSelected">
																		@getBankItem.bank_code - @getBankItem.bank_desc
																	</option>
																}
															</select>
														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">สาขา</label>
													<div class="form-group ">
														<div class="input-group">
															<input class="format-money form-control" type="text"
																   style="text-align: center; width: 30%;" disabled="@(bankBranch == null)" name="bank_code" value="@bankbranch_code"
															@oninput="OnBankBranchChanged" />	
															@if(bankBranch ==null){
																<select id="getBankSelect" disabled class="form-select" style="width: 70%;">
																	<option value=""></option>
																</select>
																}else{
																<select id="getBankSelect" class="form-select" @onchange="OnBankBranchSelectChanged" style="width: 70%;">
																<option selected disabled>--กรุณาเลือก--</option>
																@foreach (var bankBranchItem in bankBranch)
																{
																	bool isCurrentOptionSelected = bankBranchItem.branch_id == BankBranchValues;
																	<option value="@bankBranchItem.branch_id" selected="@isCurrentOptionSelected">
																		@bankBranchItem.branch_id - @bankBranchItem.branch_name
																	</option>
																}
																</select>
																}
															
														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">เลขที่บัญชี</label>
													<input class="form-control" style="text-align: end;" type="text" Name="prncbal"
													@bind-value="check_no" />
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ชื่อบัญชี</label>
													<input class="form-control" style="text-align: end;" type="text" Name="prncbal"
													@bind-value="bankaccount_name" />
												</div>
												@* <div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">รหัสคู่บัญชี</label>
													 <select id="tofromaccSelect" class="form-select" value="@bookCode"
													@onchange="OnToFromAccChanged">
														@if (Item.tofromacc == null || !Item.tofromacc.Any())
														{
															<option selected disabled></option>
														}
														else
														{
															<option selected disabled>--กรุณาเลือก--</option>
															@foreach (var tofromaccItem in Item.tofromacc)
															{ 
																@if (tofromaccItem.cash_type == cashTypeValue)
																{
																	<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																			selected="@isCurrentOptionSelected">
																		@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																	</option>
																} 
															 }
														}
													</select>
												</div> *@
											}
											@* else
											{
												@if (Item.moneytype_code == "CSH")
												{
													<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														<select id="tofromaccSelect" class="form-select" value="@bookCode"
														@onchange="OnToFromAccChanged">
															@if (Item.tofromacc == null || !Item.tofromacc.Any())
															{
																<option selected disabled></option>
															}
															else
															{
																<option selected disabled>--กรุณาเลือก--</option>
																@foreach (var tofromaccItem in Item.tofromacc)
																{
																	isCurrentOptionSelected = true;
																	@if (tofromaccItem.cash_type == Item.moneytype_code)
																	{
																		<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																				selected="@isCurrentOptionSelected">
																			@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																		</option>
																	}
																}
															}
														</select>
													</div>
												}
											} *@

											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">คงเหลือ</label>
												<input class="form-control" style="text-align: end;" readonly type="text" Name="prncbal"
												@bind-value="prncbal" />
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ถอนได้</label>
												<input class="form-control" style="text-align: end;" readonly type="text" Name="withdrawable_amt" @bind-value="withdrawable_amt" />
													   @* @{var Item.withdrawable_amt =  Item.withdrawable_amt?.ToString("N2");} *@
													  @* <RadzenTextBox  Name="withdrawable_amt" @bind-Value="@(Item.withdrawable_amt.ToString("N2"))" class="form-control" style="text-align: end;"></RadzenTextBox> *@

											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">อายัดรวม</label>
												<input class="form-control" style="text-align: end;" readonly type="text" Name="sequest_amont"
												@bind-value="sequest_amont" />
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">เช็คเรียกเก็บ</label>
												<input class="form-control" style="text-align: end;" readonly type="text" Name="checkpend_amt"
												@bind-value="checkpend_amt" />
											</div>
											@if(recpPayTypeCode == "WTE"||recpPayTypeCode == "WBK"||Item.recppaytype_code == "WTE"||Item.recppaytype_code == "WBK"){
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">การหักค่าธรรมเนียม</label>
												<select class="form-select" @bind="Item.payfee_meth" >
													<option Value="0">เลือก</option>
													<option Value="1">ชำระเป็นเงินสด</option>
													<option Value="2">ชำระหักจากยอดถอน</option>
													<option Value="3">ชำระหักในบัญชีเงินฝาก</option>
													<option Value="-9">ไม่คิดค่าธรรมเนียม</option>
												</select>
											</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ค่าธรรมเนียม</label>
												<input class="form-control" style="text-align: end;" readonly type="text" Name="checkpend_amt"
												@bind-value="Item.fee_amt" />
											</div>
											}
										</div>
										<div class="row">
											@* <div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
										<label class="form-label" for="">อายัดรวม</label>
										<input class="form-control" style="text-align: end;" readonly type="text" Name="sequest_amont"
										@bind-value="sequest_amont" />
										</div>
										<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
										<label class="form-label" for="">เช็คเรียกเก็บ</label>
										<input class="form-control" style="text-align: end;" readonly type="text" Name="checkpend_amt"
										@bind-value="checkpend_amt" />
										</div>
										<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
										<label class="form-label" for="">ยอดฝากได้</label>
										<input class="form-control" style="text-align: end;" type="text" Name="deptslip_amt"
										@bind-value="Item.deptslip_amt" />
										</div> *@
											<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ด/บ</label>
												<input type="text" class="format-money form-control" readonly style="text-align: end;"
													   Name="int_amt" value="@(int_amt!= null ? Item.int_amt:int_amt)" placeholder="0.00"
													/>

											</div>
											<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">โบนัส</label>
												<input type="text" class="format-money form-control" readonly style="text-align: end;"
													   Name="intbonus_amt" value="@intbonus_amt" placeholder="0.00"
													/>

											</div>
											<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ภาษี ด/บ</label>
												<input type="text" class="format-money form-control" readonly style="text-align: end;"
													   Name="tax_amt" value="@(tax_amt!= null ? Item.tax_amt:tax_amt)" placeholder="0.00"
													/>

											</div>
											<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ด/บ คืน</label>
												<input type="text" class="format-money form-control" readonly style="text-align: end;"
													   Name="int_return" value="@Item.int_return" placeholder="0.00"/>

											</div>
											<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ภาษี คืน</label>
												<input type="text" class="format-money form-control" readonly style="text-align: end;"
													   Name="tax_return" value="@Item.tax_return" placeholder="0.00" />

											</div>
											<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ด/บ สุทธิ</label>
												<input type="text" class="format-money form-control" readonly style="text-align: end;"
													   Name="int_netamt" value="@Item.int_netamt" placeholder="0.00"  />

											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ยอดทำรายการ</label>
												<div class="form-group ">
													<div class="input-group">
														<input type="text" class="format-money form-control" style="text-align: end;"
														@bind="DeptslipAmt" placeholder="0.00"   @onblur="() => FormatNumber()" />
														<div class="input-group-addon">
															<RadzenIcon class="icons icon-search" Icon="ballot" data-bs-toggle="modal"
																		data-bs-target="#myModal1" />
														</div>
													</div>
												</div>
												<!-- The Modal -->
												<div class="modal" id="myModal1">
													<div class="modal-dialog modal-xl">
														<div class="modal-content">
															<!-- Modal Header -->
															<div class="modal-header">
																<h4 class="modal-title">ข้อมูลสมาชิก</h4>
																<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
															</div>
															<!-- Modal body -->
															<div class="modal-body">
																<div style="margin: 20px">
																</div>
																<span>
																	<asp:Button ID="b_calChange" runat="server"
																				Style="float: left; width: 100%; height: 25px" Text="คำนวณเงินทอน"
																				TabIndex="12" BackColor="#556B2F" ForeColor="White" />
																</span>

																<!-- Modal footer -->
																<div class="modal-footer">
																	<button type="button" class="btn btn-danger"
																			data-bs-dismiss="modal">
																		Close
																	</button>
																</div>

															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">เพื่อ</label>
												<RadzenTextBox class="form-control" type="text" readonly Name="dept_objective"
												@bind-value="Item.dept_objective" />
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ยอดในสมุด</label>
												<RadzenTextBox class="form-control" type="text" readonly Name="dept_objective"
												@bind-value="Item.dept_objective" />
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ยอดสุทธิ</label>
												<input class="format-money form-control" placeholder="0.00" type="text"
													   style="text-align: end; font-size: 32px;" readonly name="deptslip_netamt"
												@bind="DeptslipAmt" id="showNumber" />
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">เงื่อนไขการถอน</label>
												<textarea class="form-control " readonly @bind="Item.condforwithdraw" name="condforwithdraw"
														  id="" cols="30" rows="2"></textarea>
											</div>
										</div>
									</div>
									@if (recpPayTypeCode == "DEN")
									{

										<div class="row mt-5">
											<div class="col-12">
												<div class="row">
													<div class="col-2" style="text-align: end;">
														<h4>รายการเช็ค:</h4>
													</div>
													<div class="col-4">
														<button class="btn btn-outline-primary" style="border: solid 1px #d1d1d1;"
														@onclick="AddRow">
															เพิ่มแถว
														</button>
													</div>
												</div>
											</div>
											<div class=" mt-1">
												<div class="row mt-2">
													<div class="col-12">
														<table class="table table-bordered" style="width: 100%;">
															<thead>
																<tr>
																	<th style="text-align: center;width:10%;background-color: rgb(166, 207, 243);">
																		เลขที่เช็ค
																	</th>
																	<th style="text-align: center;width:13%;background-color: rgb(166, 207, 243);">
																		วันที่หน้าchq
																	</th>
																	<th style="text-align: center;width:8%;background-color: rgb(166, 207, 243);">
																		รหัส
																	</th>
																	<th style="text-align: center;width:20%;background-color: rgb(166, 207, 243);">
																		ธนาคาร
																	</th>
																	<th style="text-align: center;width:8%;background-color: rgb(166, 207, 243);">
																		รหัส
																	</th>
																	<th style="text-align: center;width:20%;background-color: rgb(166, 207, 243);">
																		สาขา
																	</th>
																	<th style="text-align: center;width:3%;background-color: rgb(166, 207, 243);">
																	</th>
																	<th style="text-align: center;width:15%;background-color: rgb(166, 207, 243);">
																		จำนวนเงิน
																	</th>
																	<th style="text-align: center;width:3%;background-color: rgb(166, 207, 243);">
																		ลบ
																	</th>
																</tr>
															</thead>
															<tbody>
																@if (rows != null && rows.Count > 0)
																{
																	@foreach (var row in rows)
																	@* @for (var index = 0; index < rows.Count; index++) *@
																	{
																		<tr>
																			<td>
																				<input class="form-control"
																					   style="width:100%;text-align: center; border: solid 1px #fff;"
																					   placeholder="0" type="text" @bind="row.cheque_no" />
																			</td>
																			<td>
																				<RadzenDatePicker class="inputrPicker" @bind-Value=row.cheque_date
																								  Name="operate_date" DateFormat="dd/MM/yyyy" />
																			</td>
																			<td>
																				<input class="form-control"
																					   style="width:100%;text-align: center; border: solid 1px #fff;"
																					   type="text" @bind-value="row.bank_code" @oninput="OnGetBankChanged" />
																			</td>
																			<td>
																				<select id="getBankSelect" class="form-select"
																				@onchange="OnGetBankSelectChanged">
																					<option selected disabled>--กรุณาเลือก--</option>
																					@foreach (var getBankItem in getBank)
																					{
																						bool isCurrentOptionSelected = getBankItem.bank_code == row.bank_code;
																						<option value="@getBankItem.bank_code"
																								selected="@isCurrentOptionSelected">
																							@getBankItem.bank_code - @getBankItem.bank_desc
																						</option>
																					}
																				</select>
																				<RadzenDropDown @ref="radzenDropDown" @bind-SearchText="searchText"
														FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
														FilterOperator="StringFilterOperator.StartsWith" AllowFiltering="true"
														Data="@getBank" TextProperty="bank_desc" ValueProperty="bank_code"
														AllowClear="true" @bind-Value="selectedCustomer"
														Style="width: 100%; max-width: 400px;" />

																			</td>

																			<td>
																				<input class="form-control"
																					   style="width:100%;text-align: center; border: solid 1px #fff;"
																					   type="text" @bind="row.branch_id" />

																			</td>
																			<td>
																				<select class="form-select">
																						@if(bankBranch ==null){
																<option selected disabled>--กรุณาเลือก--</option>
																}else{
																					<option selected disabled>--กรุณาเลือก--</option>
																					@foreach (var bankBranchItem in bankBranch)
																					{
																						bool isCurrentOptionSelected = bankBranchItem.branch_id ==
																						row.branch_id;
																						<option value="@bankBranchItem.branch_id"
																								selected="@isCurrentOptionSelected">
																							@bankBranchItem.branch_id - @bankBranchItem.branch_name
																						</option>
																					}
																					}
																				</select>
																			</td>
																			<td>
																				<RadzenIcon style="width:100%" class="icons icon-search" Icon="ballot"
																							data-bs-toggle="modal" data-bs-target="#myModal1" />
																			</td>
																			<td>
																				<input class="form-control"
																					   style="width:100%;text-align: end;border: solid 1px #fff;"
																					   placeholder="0.00" onblur="formattNumberr(this)" type="text"
																				@bind="row.cheque_amt" />
																			</td>
																			<td style="width:100%">
																				<button class="btn btn-outline-danger"
																				@onclick="() => RemoveRow(row)">
																					ลบ
																				</button>
																			</td>
																		</tr>
																	}
																}
															</tbody>
														</table>
													</div>
												</div>
											</div>
										</div>
									}
								}
							@* </form> *@
							<div class="card mt-4" >
								<div class="row mt-2">
									<RadzenTabs @bind-SelectedIndex=@selectedIndex>
										<Tabs>
											<RadzenTabsItem Text="รายละเอียดต้นเงิน">
												<RadzenDataGrid @ref="grid" Data="@(deptSlipdetDetails)" AllowRowSelectOnRowClick="@allowRowSelectOnRowClick" AllowPaging="true" PageSize="10"AllowSorting="true"   TItem="Models.DeptSlipdet" SelectionMode="DataGridSelectionMode.Multiple" @bind-Value=@selectedEmployees  PagerHorizontalAlign="HorizontalAlign.Right" ShowPagingSummary="true"  Style="width: 2500px;">
												 <Columns>
													@* <HeaderTemplate>
														  <RadzenCheckBox TabIndex="-1" TriState="false" TValue="bool?" InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "Select all items" }})"
														Value="@(selectedEmployees == null || selectedEmployees?.Any() != true ? false : !deptSlipdetDetails.All(i => selectedEmployees.Contains(i)) ? null : deptSlipdetDetails.Any(i => selectedEmployees.Contains(i)))"
														Change="@(args => 
														{
															var isChecked = args == true;
															foreach (var item in deptSlipdetDetails)
															{
																item.select_flag = isChecked ? 1 : 0;
																if (isChecked)
																{
																	grid.SelectRow(item);
																}
															}
														})" />
													</HeaderTemplate>	 *@
													<RadzenDataGridColumn TItem="Models.DeptSlipdet" Width="5%" Property="select_flag" Sortable="false" Filterable="false">
												
														<Template Context="data">
																<RadzenCheckBox TabIndex="-1" @onclick="@(e => SummaryTotle(data))" TriState="false" Value="@(data.select_flag == 1)" InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "Select item" }})"
																	TValue="bool" 
																	Change=@(args => { 
																		data.select_flag = data.select_flag == 1 ? 0 : 1; // สลับค่าของ select_flag ระหว่าง 0 และ 1
																		if(data.select_flag == 1) { 
																			grid.SelectRow(data); // เลือกแถวเมื่อ select_flag เป็น 1
																			data.IsChecked = true;
																		};
																	CalculateTotal();})
																	>
																	</RadzenCheckBox>
															</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="7%" TItem="Models.DeptSlipdet" Property="prnc_no" Title="ต้นเงิน">
														<Template Context="data">
															<RadzenText  @onclick="@(e => SummaryTotle(data))"> @data.prnc_no</RadzenText>
														</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="prnc_bal" Title="ต้นเงินคงเหลือ	">
														<Template Context="data">
																@* <div><p @onclick="@(e => SummaryTotle(data))" style="text-align: end;">@data.prnc_bal?.ToString("#,##0.00")</p></div> *@
																<RadzenText  @onclick="@(e => SummaryTotle(data))" Style="text-align: end;"> @data.prnc_bal?.ToString("#,##0.00")</RadzenText>
															</Template>
													</RadzenDataGridColumn>	
													<RadzenDataGridColumn Width="12%" TItem="Models.DeptSlipdet" Property="prncslip_amt" Title="ยอดเงินทำรายการ">
														<Template Context="data">
															<div @onchange="@(e => SummaryTotle(data))">
																@if(data.select_flag == 1)
																 {
																		<RadzenTextBox Change=@(e => SummaryTotle(data))
																			class="format-money form-control"
																			Style="text-align: end;"
																			@bind-Value="data.prncslipAmt_String"
																			Placeholder="0.00" ToolTip="#,##0.00"
																			Width="100%" 
																			@onblur="() => CalculateTotal()"/>

																}else{
																<input  class="form-control" disabled placeholder="0.00" value="@prncslip_amt" type="text" Style="text-align: end; width: 100%; background-color: transparent; border: 0px;" />
																}
															</div>
														</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="prnc_date" Title="วันที่ต้นเงิน">
															<Template Context="data">
																<RadzenText> @data.prnc_date?.ToString("dd/MM/yyyy")</RadzenText>
															</Template>
													</RadzenDataGridColumn>	
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="prncdue_date" Title="วันครบกำหนด">
															<Template Context="data">
																<RadzenText  @onclick="@(e => SummaryTotle(data))"> @data.prncdue_date?.ToString("dd/MM/yyyy")</RadzenText>
															</Template>
													</RadzenDataGridColumn>	
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="calint_from" Title="วันเริ่มคิดด/บถึง">
														<Template Context="data">
																<RadzenText  @onclick="@(e => SummaryTotle(data))"> @data.calint_from?.ToString("dd/MM/yyyy")</RadzenText>
														</Template>
													</RadzenDataGridColumn>	
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="calint_to" Title="วันคิดด/บถึง">
														<Template Context="data">
															<RadzenText  @onclick="@(e => SummaryTotle(data))">@data.calint_to?.ToString("dd/MM/yyyy")</RadzenText>
														</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="intpay_amt" Title="ด/บ จ่าย">
														<Template Context="data">
															<RadzenText  @onclick="@(e => SummaryTotle(data))" Style="text-align: end;">@data.intpay_amt?.ToString("#,##0.00")</RadzenText>
															</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="taxpay_amt" Title="ภาษี">
															<Template Context="data">
															<RadzenText  @onclick="@(e => SummaryTotle(data))" Style="text-align: end;">@data.taxpay_amt?.ToString("#,##0.00")</RadzenText>
															</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="intslip_net" Title="ด/บ.หลังหักภาษี">
														@* <Template Context="data">
															<RadzenText  @onclick="@(e => SummaryTotle(data))">@intslip_net</RadzenText>
														</Template> *@
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="intbf_accyear" Title="ด/บค้าง">
														<Template Context="data">
																<RadzenText  @onclick="@(e => SummaryTotle(data))" Style="text-align: end;">@data.intbf_accyear?.ToString("#,##0.00")</RadzenText>
															</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="fee_amt" Title="ค่าปรับ">
															<Template Context="data">
																<RadzenText  @onclick="@(e => SummaryTotle(data))" Style="text-align: end;">@data.fee_amt?.ToString("#,##0.00")</RadzenText>
															</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="int_return" Title="ด/บ เรียกคืน">
														<Template Context="data">
																<RadzenText  @onclick="@(e => SummaryTotle(data))" Style="text-align: end;">@data.int_return?.ToString("#,##0.00")</RadzenText>
															</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="tax_return" Title="ภาษี เรียกคืน" >
														<Template Context="data">
															<RadzenText  @onclick="@(e => SummaryTotle(data))" Style="text-align: end;">@data.tax_return?.ToString("#,##0.00")</RadzenText>
														</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="interest_rate" Title="อัตราดอกเบี้ย">
													<Template Context="data">
															<RadzenText  @onclick="@(e => SummaryTotle(data))" Style="text-align: end;">@data.interest_rate?.ToString("#,##0.00")</RadzenText>
															</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="preint_rate" Title="อัตราดอกเบี้ยก่อนกำหนด">
														<Template Context="data">
															<RadzenText  @onclick="@(e => SummaryTotle(data))"Style="text-align: end;">@data.preint_rate?.ToString("#,##0.00")</RadzenText>
															</Template>
													</RadzenDataGridColumn>
													<RadzenDataGridColumn Width="10%" TItem="Models.DeptSlipdet" Property="day_calint" Title="จำนวนวัน">
														<Template Context="data">
															<RadzenText  @onclick="@(e => SummaryTotle(data))">@data.day_calint</RadzenText>
															</Template>
													</RadzenDataGridColumn>
													@* <RadzenDataGridColumn TItem="Models.DeptSlipdet" Property="day_calint" Title="จำนวนวัน" FormatString="{0:d}"/> *@
												</Columns> 
											</RadzenDataGrid>
											</RadzenTabsItem>
											<RadzenTabsItem Text="ลายเซ็น">
												ลายเซ็น
											</RadzenTabsItem>
											<RadzenTabsItem Text="ผู้ฝากร่วม">
												<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails" ColumnWidth="200px"
																AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand"
																FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10" AllowPaging="true"
																AllowSorting="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
													<Columns>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ลำดับ" Property="prnc_no">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="เลขอ้างอิง" Property="prnc_bal">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ชื่อ - นามสกุล"
																			  Property="prncslip_amt">
														</RadzenDataGridColumn>
													</Columns>
												</RadzenDataGrid>
											</RadzenTabsItem>
											<RadzenTabsItem Text="การอายัดบัญชี">
												<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails" ColumnWidth="200px"
																AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand"
																FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10" AllowPaging="true"
																AllowSorting="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
													<Columns>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ลำดับ" Property="prnc_no">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันที่เริ่มต้น	"
																			  Property="prnc_bal">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันที่สิ้นสุด	"
																			  Property="prncslip_amt">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="รายการ" Property="prnc_date">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="สาเหตุการอายัด"
																			  Property="prncdue_date">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ยอดเงิน" Property="calint_from">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ผู้ทำรายการ"
																			  Property="calint_to">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="หมายเหตุ" Property="intpay_amt">
														</RadzenDataGridColumn>
													</Columns>
												</RadzenDataGrid>
											</RadzenTabsItem>
										</Tabs>
									</RadzenTabs>
								</div>
							</div>
						}
					</RadzenStepsItem>
					<RadzenStepsItem Disabled="@(disable)" Text="ตรวจสอบรายการ" @onclick="@CheckDeptslipAmt">
						<RadzenRow>
							<RadzenText Text="ตรวจสอบรายละเอียด" />
						</RadzenRow>
						@if (datadetail != null)
						{
							<form @onsubmit="PerformSearch">
								@foreach (var item in datadetail)
								{
									var Item = item.deptSlip;
									<div class="row" style="margin-left: calc(var(--bs-gutter-x) * -.21);margin-bottom: 15px;">
										<div class="row">
											<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">เลขที่บัญชี</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@deptno_format" />
														</div>
													</div>
												</div>
											</div>
											@* <div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ทำรายการ</label>
												<select id="recppaytypeSelect" @bind="group_itemtype" name="group_itemtype" style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();" disabled class="form-select">
													<option selected value="WID">(-) ถอน</option>
													<option value="CLS">(/) ปิดบัญชี</option>
												</select>
											</div> *@
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">รายการ</label>
												<div class="form-group ">
												<div class="input-group">
													@if (selectedRecppaytype == null)
													{
														<select id="recppaytypeSelect" name="recppaytype_code" style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();" disabled class="form-select"
														@onchange="RecpPayTypeChanged">
															@if (Item.recppaytype == null || !Item.recppaytype.Any())
															{
																<option selected disabled></option>
															}
															else
															{
																<option selected disabled></option>
																@foreach (var recppaytypeItem in Item.recppaytype)
																{
																	if (recppaytypeItem.recppaytype_code == Item.recppaytype_code)
																	{
																		isCurrentOptionSelected = true;

																	}
																	else
																	{
																		isCurrentOptionSelected = false;
																	}
																	if (recppaytypeItem.genvc_flag == 1)
																	{
																		<option value="@($"{recppaytypeItem.cash_type}|{recppaytypeItem.tofrom_accid}_{recppaytypeItem.recppaytype_code}_{recppaytypeItem.cash_type}_{recppaytypeItem.recppaytype_desc}")"
																				selected="@isCurrentOptionSelected">
																			@recppaytypeItem.recppaytype_code - @recppaytypeItem.recppaytype_desc
																		</option>
																	}
																}
															}
														</select>
													}
													else
													{
														<RadzenText Text="@selectedRecppaytype" />
													}
												</div>
											</div>
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
											<label class="form-label" for="">รหัสคู่บัญชี</label>
												<div class="form-group ">
													<div class="input-group">
														@if(selectedValue == null){
														<select id="tofromaccSelect" class="form-select"  @bind="selectedValue"
																style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();"disabled>
															@if (Item.tofromacc == null || !Item.tofromacc.Any())
															{
																<option selected disabled>--กรุณาเลือก--</option>
															}
															else
															{
																<option selected disabled>--กรุณาเลือก--</option>
																@foreach (var tofromaccItem in Item.tofromacc)
																{
																	bool isCashTypeSelected = (tofromaccItem.cash_type == cashTypeValue);
																	bool isItemAccIdSelected = (tofromaccItem.cash_type == Item.moneytype_code);
																	bool isCurrentOptionSelected = (tofromaccItem.tofrom_accid == valuetoFromaccId);
																	if (isCashTypeSelected)
																	{
																		// เลือก <option> เมื่อ isCashTypeSelected เป็น true
																		if (valuetoFromaccId == null|| toFromaccId2 == null)
																		{
																			<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																					selected="@isCurrentOptionSelected">
																				@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc 1
																			</option>
																		}
																		else
																		{
																			<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																					selected="@isCurrentOptionSelected">
																				@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc 2
																			</option>
																		}
																	}
																	else if (isItemAccIdSelected)
																	{
																		// เลือก <option> เมื่อ isItemAccIdSelected เป็น true
																		if (valuetoFromaccId == null|| toFromaccId2 == null)
																		{
																			<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																					selected="@isItemAccIdSelected">
																				@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc 3
																			</option>
																		}
																	}
																}
															}
														</select>
														}else{
															<select id="tofromaccSelect" class="form-select"  @bind="selectedToFromAcc" style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();"disabled>
																	@foreach (var tofromaccItem in Item.tofromacc)
																	{
																		<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																						selected="@isCurrentOptionSelected">
																					@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc 4
																		</option>
																	}
															</select>
														}
													</div>
												</div>
											</div>
											<div class="col-xl-2 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">วันที่</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@String.Format("{0:dd/MM/yyyy}", Item.operate_date)" />
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="row">
											<div class="col-xl-2 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">เลขสมาชิก</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@Item.member_no" />
														</div>
													</div>
												</div>
											</div>
											<div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ชื่อบัญชี</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@Item.deptaccount_name" />
														</div>
													</div>
												</div>
											</div>
											<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ประเภทบัญชี</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@Item.depttype_desc" />
														</div>
													</div>
												</div>
											</div>

											@* <div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
								<label class="form-label" for="">เลขบัตรประชาชน</label>
								<div class="form-group ">
								<div class="label-group">
								<div class="input-group-addon">
								<RadzenText Text="@card_person" />
								</div>
								</div>
								</div>
								</div> *@

											@* <div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
								<label class="form-label" for="">ทำรายการโดย</label>
								<select class="form-select" @bind="nobook_flag" style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();" disabled>
								<option Value="0">มีสมุด</option>
								<option Value="1">ไม่มีสมุด</option>
								</select>
								</div> *@
											<div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ประเภทเงิน</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@(cashTypeValue == null ? Item.moneytype_code : cashTypeValue)" />
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="row">
											<div class="col-xl-2 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">เลขสมุด</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@Item.deptpassbook_no" />
														</div>
													</div>
												</div>
											</div>
											@if (cashTypeValue == "CSH")
											{
												@* @if (recpPayTypeCode == "WTD")
												{
													<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														<div class="form-group ">
															<div class="input-group">
																<select id="tofromaccSelect" class="form-select" value="@bookCode"
																		style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();" disabled>
																	@if (Item.tofromacc == null || !Item.tofromacc.Any())
																	{
																		<option selected disabled></option>
																	}
																	else
																	{
																		<option selected disabled>--กรุณาเลือก--</option>
																		@foreach (var tofromaccItem in Item.tofromacc)
																		{
																			@if (tofromaccItem.cash_type == cashTypeValue)
																			{
																				<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																						selected="@isCurrentOptionSelected">
																					@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																				</option>
																			}
																		}
																	}
																</select>
															</div>
														</div>
													</div>
												}
												else
												{
													<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														<div class="form-group ">
															<div class="input-group">
																<select id="tofromaccSelect" class="form-select" value="@bookCode"
																		style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();" disabled>
																	@if (Item.tofromacc == null || !Item.tofromacc.Any())
																	{
																		<option selected disabled></option>
																	}
																	else
																	{
																		<option selected disabled>--กรุณาเลือก--</option>
																		@foreach (var tofromaccItem in Item.tofromacc)
																		{
																			@if (tofromaccItem.cash_type == cashTypeValue)
																			{
																				<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																						selected="@isCurrentOptionSelected">
																					@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																				</option>
																			}
																		}
																	}
																</select>
															</div>
														</div>
													</div>
												} *@
											}
											else if (cashTypeValue == "TRN" || Item.moneytype_code == "TRN")
											{
												@* @if (recpPayTypeCode == "WIB")
												{
													<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														<div class="form-group ">
															<div class="input-group">
																<select id="tofromaccSelect" class="form-select" style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();" disabled>
																	@if (Item.tofromacc == null || !Item.tofromacc.Any())
																	{
																		<option selected disabled></option>
																	}
																	else
																	{
																		<option selected disabled>--กรุณาเลือก--</option>
																		@foreach (var tofromaccItem in Item.tofromacc)
																		{
																			isCurrentOptionSelected = true;
																			@if (tofromaccItem.cash_type == cashTypeValue)
																			{
																				<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																						selected="@isCurrentOptionSelected">
																					@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																				</option>
																			}

																		}
																	}
																</select>
															</div>
														</div>
													</div>
												}
												else
												{
													<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														<div class="form-group ">
															<div class="input-group">
																<select id="tofromaccSelect" class="form-select" style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();" disabled>
																	@if (Item.tofromacc == null || !Item.tofromacc.Any())
																	{
																		<option selected disabled></option>
																	}
																	else
																	{
																		<option selected disabled>--กรุณาเลือก--</option>
																		@foreach (var tofromaccItem in Item.tofromacc)
																		{
																			isCurrentOptionSelected = true;
																			@if (tofromaccItem.cash_type == cashTypeValue)
																			{
																				<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																						selected="@isCurrentOptionSelected">
																					@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																				</option>
																			}

																		}
																	}
																</select>
															</div>
														</div>
													</div>
												} *@
											}
											else if (cashTypeValue == "CBT" || Item.moneytype_code == "CBT" || cashTypeValue == "CHQ" ||
											Item.moneytype_code == "CHQ")
											{
												<div class="col-xl-2 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">เลขที่บัญชี</label>
													<div class="form-group ">
														<div class="label-group">
															<div class="input-group-addon">
																<RadzenText Text="@check_no" />
															</div>
														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ธนาคาร</label>
													<div class="form-group ">
														<div class="input-group">
															<select id="getBankSelect" class="form-select" style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();" disabled>
																<option selected disabled>--กรุณาเลือก--</option>
																@foreach (var getBankItem in getBank)
																{
																	bool isCurrentOptionSelected = getBankItem.bank_code == BankValues;
																	<option value="@getBankItem.bank_code" selected="@isCurrentOptionSelected">
																		@getBankItem.bank_code - @getBankItem.bank_desc
																	</option>
																}
															</select>
														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">สาขา</label>
													<div class="form-group ">
														<div class="input-group">
															<select id="getBankSelect" class="form-select" style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url() " disabled>
																@if(bankBranch ==null){
																<option selected disabled>--กรุณาเลือก--</option>
																}else{
																	@foreach (var bankBranchItem in bankBranch)
																	{
																		bool isCurrentOptionSelected = bankBranchItem.branch_id == BankBranchValues;
																		<option value="@bankBranchItem.branch_id" selected="@isCurrentOptionSelected">
																			@bankBranchItem.branch_id - @bankBranchItem.branch_name
																		</option>
																	}
																}
															</select>
														</div>
													</div>
												</div>
												<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ชื่อบัญชี</label>
													<div class="form-group ">
														<div class="label-group">
															<div class="input-group-addon">
																<RadzenText Text="@bankaccount_name" />
															</div>
														</div>
													</div>
												</div>
												@* <div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">รหัสคู่บัญชี</label>
													<div class="form-group ">
														<div class="input-group">
															<select id="tofromaccSelect" class="form-select" value="@bookCode"
																	style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();" disabled>
																@if (Item.tofromacc == null || !Item.tofromacc.Any())
																{
																	<option selected disabled></option>
																}
																else
																{
																	<option selected disabled>--กรุณาเลือก--</option>
																	@foreach (var tofromaccItem in Item.tofromacc)
																	{
																		@if (tofromaccItem.cash_type == cashTypeValue)
																		{
																			<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																					selected="@isCurrentOptionSelected">
																				@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																			</option>
																		}
																	}
																}
															</select>
														</div>
													</div>
												</div> *@
											}

											@* else
											{
												@if (Item.moneytype_code == "CSH")
												{
													<div class="col-xl-4 col-md-6 col-sm-6 d-flex flex-column">
														<label class="form-label" for="">รหัสคู่บัญชี</label>
														<div class="form-group ">
															<div class="input-group">
																<select id="tofromaccSelect" class="form-select" value="@bookCode"
																		style="background-color:transparent; border-color: transparent;--bs-form-select-bg-img:url();" disabled>
																	@if (Item.tofromacc == null || !Item.tofromacc.Any())
																	{
																		<option selected disabled></option>
																	}
																	else
																	{
																		<option selected disabled>--กรุณาเลือก--</option>
																		@foreach (var tofromaccItem in Item.tofromacc)
																		{
																			isCurrentOptionSelected = true;
																			@if (tofromaccItem.cash_type == Item.moneytype_code)
																			{
																				<option value="@($"{tofromaccItem.cash_type}|{tofromaccItem.tofrom_accid}")"
																						selected="@isCurrentOptionSelected">
																					@tofromaccItem.tofrom_accid - @tofromaccItem.tofrom_accdesc
																				</option>
																			}
																		}
																	} 
																</select>
															</div>
														</div>
													</div>
												}
											}*@

											<div class="col-xl-2 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">คงเหลือ</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@Item.prncbal?.ToString()" />
														</div>
													</div>
												</div>
											</div>
											<div class="col-xl-2 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ถอนได้</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@Item.withdrawable_amt?.ToString()" />
														</div>
													</div>
												</div>
											</div>
											@* <div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
								<label class="form-label" for="">อายัดรวม</label>
								<div class="form-group ">
								<div class="label-group">
								<div class="input-group-addon">
								<RadzenText Text="@sequest_amont?.ToString()" />
								</div>
								</div>
								</div>
								</div> *@
											@* <div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
								<label class="form-label" for="">เช็คเรียกเก็บ</label>
								<div class="form-group ">
								<div class="label-group">
								<div class="input-group-addon">
								<RadzenText Text="@checkpend_amt?.ToString()" />
								</div>
								</div>
								</div>
								</div> *@
										</div>
										<div class="row">
											@if (group_itemtype == "CLS")
											{
												<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ด/บ</label>
													<div class="form-group ">
														<div class="label-group">
															<div class="input-group-addon">
																<RadzenText Text="@(int_amt?.ToString()!= null ? Item.int_amt?.ToString():int_amt?.ToString())" />
															</div>
														</div>
													</div>
												</div>
												<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">โบนัส</label>
													<div class="form-group ">
														<div class="label-group">
															<div class="input-group-addon">
																<RadzenText Text="@(intbonus_amt?.ToString())" />
															</div>
														</div>
													</div>
												</div>
												<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ภาษี ด/บ</label>
													<div class="form-group ">
														<div class="label-group">
															<div class="input-group-addon">
																<RadzenText Text="@(tax_amt?.ToString()!= null ? Item.tax_amt?.ToString():tax_amt?.ToString())" />
															</div>
														</div>
													</div>
												</div>
												<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ด/บ คืน</label>
													<div class="form-group ">
														<div class="label-group">
															<div class="input-group-addon">
																<RadzenText Text="@(int_return?.ToString())" />
															</div>
														</div>
													</div>
												</div>
												<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ภาษี คืน</label>
													<div class="form-group ">
														<div class="label-group">
															<div class="input-group-addon">
																<RadzenText Text="@(tax_return?.ToString())" />
															</div>
														</div>
													</div>
												</div>
												<div class="col-xl-2 col-md-4 col-sm-6 d-flex flex-column">
													<label class="form-label" for="">ด/บ สุทธิ</label>
													<div class="form-group ">
														<div class="label-group">
															<div class="input-group-addon">
																<RadzenText Text="@(int_netamt?.ToString())" />
															</div>
														</div>
													</div>
												</div>
											}
											<div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ยอดทำรายการ</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@(DeptslipAmt?.ToString())" />
														</div>
													</div>
												</div>
											</div>
											@* <div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
								<label class="form-label" for="">เพื่อ</label>
								<div class="form-group ">
								<div class="label-group">
								<div class="input-group-addon">
								<RadzenText Text="@Item.dept_objective" />
								</div>
								</div>
								</div>
								</div>
								<div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
								<label class="form-label" for="">ยอดในสมุด</label>
								<div class="form-group ">
								<div class="label-group">
								<div class="input-group-addon">
								<RadzenText Text="@(book_balance.ToString())" />
								</div>
								</div>
								</div>
								</div> *@
											<div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
												<label class="form-label" for="">ยอดสุทธิ</label>
												<div class="form-group ">
													<div class="label-group">
														<div class="input-group-addon">
															<RadzenText Text="@(DeptslipAmt?.ToString())" />
														</div>
													</div>
												</div>
											</div>
											@* <div class="col-xl-3 col-md-6 col-sm-6 d-flex flex-column">
								<label class="form-label" for="">เงื่อนไขการถอน</label>
								<div class="form-group ">
								<div class="label-group">
								<div class="input-group-addon">
								<RadzenText Text="@Item.condforwithdraw" />
								</div>
								</div>
								</div>
								</div>  *@
										</div>
										@*</div>
							@if (recpPayTypeCode == "DEN")
							{

							<div class="row mt-5">
							<div class="col-12">
							<div class="row">
							<div class="col-2" style="text-align: end;">
							<h4>รายการเช็ค:</h4>
							</div>
							<div class="col-4">
							<button class="btn btn-outline-primary" style="border: solid 1px #d1d1d1;"
							@onclick="AddRow">
							เพิ่มแถว
							</button>
							</div>
							</div>
							</div>
							<div class=" mt-1">
							<div class="row mt-2">
							<div class="col-12">
							<table class="table table-bordered" style="width: 100%;">
							<thead>
							<tr>
							<th style="text-align: center;width:10%;background-color: rgb(166, 207, 243);">
							เลขที่เช็ค
							</th>
							<th style="text-align: center;width:13%;background-color: rgb(166, 207, 243);">
							วันที่หน้าchq
							</th>
							<th style="text-align: center;width:8%;background-color: rgb(166, 207, 243);">
							รหัส
							</th>
							<th style="text-align: center;width:20%;background-color: rgb(166, 207, 243);">
							ธนาคาร
							</th>
							<th style="text-align: center;width:8%;background-color: rgb(166, 207, 243);">
							รหัส
							</th>
							<th style="text-align: center;width:20%;background-color: rgb(166, 207, 243);">
							สาขา
							</th>
							<th style="text-align: center;width:3%;background-color: rgb(166, 207, 243);">
							</th>
							<th style="text-align: center;width:15%;background-color: rgb(166, 207, 243);">
							จำนวนเงิน
							</th>
							<th style="text-align: center;width:3%;background-color: rgb(166, 207, 243);">
							ลบ
							</th>
							</tr>
							</thead>
							<tbody>
							@if (rows != null && rows.Count > 0)
							{
							@foreach (var row in rows)
							@* @for (var index = 0; index < rows.Count; index++)
							{
							<tr>
							<td>
							<input class="form-control"
							style="width:100%;text-align: center; border: solid 1px #fff;"
							placeholder="0" type="text" @bind="row.cheque_no" />
							</td>
							<td>
							<RadzenDatePicker class="inputrPicker" @bind-Value=row.cheque_date
							Name="operate_date" DateFormat="dd/MM/yyyy" />
							</td>
							<td>
							<input class="form-control"
							style="width:100%;text-align: center; border: solid 1px #fff;"
							type="text" @bind-value="row.bank_code" @oninput="OnGetBankChanged" />
							</td>
							<td>
							<select id="getBankSelect" class="form-select"
							@onchange="OnGetBankSelectChanged">
							<option selected disabled>--กรุณาเลือก--</option>
							@foreach (var getBankItem in getBank)
							{
							bool isCurrentOptionSelected = getBankItem.bank_code == row.bank_code;
							<option value="@getBankItem.bank_code"
							selected="@isCurrentOptionSelected">
							@getBankItem.bank_code - @getBankItem.bank_desc
							</option>
							}
							</select>
							@* <RadzenDropDown @ref="radzenDropDown" @bind-SearchText="searchText"
							FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
							FilterOperator="StringFilterOperator.StartsWith" AllowFiltering="true"
							Data="@getBank" TextProperty="bank_desc" ValueProperty="bank_code"
							AllowClear="true" @bind-Value="selectedCustomer"
							Style="width: 100%; max-width: 400px;" />

							</td>

							<td>
							<input class="form-control"
							style="width:100%;text-align: center; border: solid 1px #fff;"
							type="text" @bind="row.branch_id" />

							</td>
							<td>
							<select class="form-select">
							<option selected disabled>--กรุณาเลือก--</option>
							@foreach (var bankBranchItem in bankBranch)
							{
							bool isCurrentOptionSelected = bankBranchItem.branch_id ==
							row.branch_id;
							<option value="@bankBranchItem.branch_id"
							selected="@isCurrentOptionSelected">
							@bankBranchItem.branch_id - @bankBranchItem.branch_name
							</option>
							}
							</select>
							</td>
							<td>
							<RadzenIcon style="width:100%" class="icons icon-search" Icon="ballot"
							data-bs-toggle="modal" data-bs-target="#myModal1" />
							</td>
							<td>
							<input class="form-control"
							style="width:100%;text-align: end;border: solid 1px #fff;"
							placeholder="0.00" onblur="formattNumberr(this)" type="text"
							@bind="row.cheque_amt" />
							</td>
							<td style="width:100%">
							<button class="btn btn-outline-danger"
							@onclick="() => RemoveRow(row)">
							ลบ
							</button>
							</td>
							</tr>
							}
							}
							</tbody>
							</table>
							</div>
							</div>
							</div>*@
									</div>
									@* } *@
								}
							</form>
							<div class="card mt-4" >
								<div class="row mt-2"
									 style="margin-left: calc(var(--bs-gutter-x) * .5);margin-right: calc(var(--bs-gutter-x) * .5);margin-bottom: 15px;">
									<RadzenTabs @bind-SelectedIndex=@selectedIndex>
										<Tabs>
											<RadzenTabsItem Text="รายละเอียดต้นเงิน">
												<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails" ColumnWidth="200px"
																AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand"
																FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10" AllowPaging="true"
																AllowSorting="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
													<Columns>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ต้นเงิน" Property="prnc_no">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ต้นเงินคงเหลือ"
																			  Property="prnc_bal">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ยอดเงินทำรายการ"
																			  Property="prncslip_amt">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันที่ต้นเงิน"
																			  Property="prnc_date">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันครบกำหนด"
																			  Property="prncdue_date">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันเริ่มคิดด/บถึง"
																			  Property="calint_from">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ด/บ จ่าย" Property="calint_to">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ภาษี" Property="intpay_amt">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ด/บ.หลังหักภาษี"
																			  Property="taxpay_amt">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ด/บค้าง" Property="intslip_net">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ค่าปรับ"
																			  Property="intbf_accyear">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ด/บ เรียกคืน"
																			  Property="int_return">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ภาษี เรียกคืน"
																			  Property="tax_return">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="อัตราดอกเบี้ย"
																			  Property="interest_rate">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="จำนวนวัน" Property="day_cal">
														</RadzenDataGridColumn>
													</Columns>
												</RadzenDataGrid>
											</RadzenTabsItem>
											<RadzenTabsItem Text="ลายเซ็น">
												ลายเซ็น
											</RadzenTabsItem>
											<RadzenTabsItem Text="ผู้ฝากร่วม">
												<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails" ColumnWidth="200px"
																AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand"
																FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10" AllowPaging="true"
																AllowSorting="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
													<Columns>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ลำดับ" Property="prnc_no">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="เลขอ้างอิง" Property="prnc_bal">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ชื่อ - นามสกุล"
																			  Property="prncslip_amt">
														</RadzenDataGridColumn>
													</Columns>
												</RadzenDataGrid>
											</RadzenTabsItem>
											<RadzenTabsItem Text="การอายัดบัญชี">
												<RadzenDataGrid Data="@dataaccDetails" TItem="Models.AccountDetails" ColumnWidth="200px"
																AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand"
																FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10" AllowPaging="true"
																AllowSorting="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
													<Columns>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ลำดับ" Property="prnc_no">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันที่เริ่มต้น	"
																			  Property="prnc_bal">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="วันที่สิ้นสุด	"
																			  Property="prncslip_amt">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="รายการ" Property="prnc_date">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="สาเหตุการอายัด"
																			  Property="prncdue_date">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ยอดเงิน" Property="calint_from">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="ผู้ทำรายการ"
																			  Property="calint_to">
														</RadzenDataGridColumn>
														<RadzenDataGridColumn TItem="Models.AccountDetails" Title="หมายเหตุ" Property="intpay_amt">
														</RadzenDataGridColumn>
													</Columns>
												</RadzenDataGrid>
											</RadzenTabsItem>
										</Tabs>
									</RadzenTabs>
								</div>
							</div>
						}
					</RadzenStepsItem>
					<RadzenStepsItem Disabled="@(currentStep == 3)" Text="เสร็จสิ้น" Last="true">
						<RadzenRow>
							<RadzenText Text="ประวัติทำรายการ" />
						</RadzenRow>
							<RadzenButton class="save_top" Icon="print" Text="@((printLoading ? "พิมพ์..." : "พิมพ์ Book"))" Click="@PrintBook_" />
						<div class="row mt-2"
			 style="margin-left: calc(var(--bs-gutter-x) * .1);margin-right: calc(var(--bs-gutter-x) * .5);margin-bottom: 15px;">
							<RadzenDataGrid Data="@statementDetails" TItem="Models.Statement_list" ColumnWidth="200px"
										AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand"
										FilterMode="FilterMode.Advanced" IsLoading="@isLoadingModals" PageSize="10" AllowPaging="true"
										AllowSorting="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true"> 
							<Columns>
								<RadzenDataGridColumn Width="10%" TItem="Models.Statement_list" Title="ลำดับ" Property="coop_id">
								</RadzenDataGridColumn>
								<RadzenDataGridColumn  Width="13%" TItem="Models.Statement_list" Title="วันที่"
													  Property="operate_date">
													  <Template Context="data">
														<div style="text-align: center;">@data.operate_date?.ToString("dd/MM/yyyy")</div>
													  </Template>
								</RadzenDataGridColumn>
								<RadzenDataGridColumn Width="13%" TItem="Models.Statement_list" Title="รายการ"
													  Property="deptitemtype_code">
								</RadzenDataGridColumn>
								<RadzenDataGridColumn Width="17%" TItem="Models.Statement_list" Title="ถอน"
													  Property="withdraw_amt">
								</RadzenDataGridColumn>
								<RadzenDataGridColumn Width="17%" TItem="Models.Statement_list" Title="ฝาก"
													  Property="deposit_amt">
								</RadzenDataGridColumn>
								<RadzenDataGridColumn Width="17%" TItem="Models.Statement_list" Title="ยอดคงเหลือ"
													  Property="prncbal">
								</RadzenDataGridColumn>
								<RadzenDataGridColumn Width="12%" TItem="Models.Statement_list" Title="พิมพ์ Book" Property="item_status">
								<Template Context="data">
								    @if (data.item_status == 1)
									{
										<div style="text-align: center;">พิมพ์</div>
									}else{
									<div style="background-color: rgb(190, 5, 5); color: white; text-align: center;">ไม่พิมพ์</div>
									}
									</Template>
								</RadzenDataGridColumn>
							</Columns>
						</RadzenDataGrid>
								</div>
					</RadzenStepsItem>
				</Steps>
			</RadzenSteps>
		</div>
	</div>
@* } *@

<script>
	$(document).ready(function () {
		var previous_data;
		$(".format-money").on('focus', function () {
			previous_data = this.value;
		}).change(function () {
			var item_amt = this.value;
			item_amt = formatNumber(Number(item_amt.replace(/[^0-9.-]+/g, "")));
			this.value = item_amt; // ต้องกำหนดค่ากลับไปให้ฟิลด์
		});
	});

	function formattNumber(input) {
		let anotherInput = document.getElementById('showNumber');
		let value = input.value.replace(/[^0-9.]/g, '');
		let number = parseFloat(value);
		if (!isNaN(number)) {
			let formattedValue = number.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			input.value = formattedValue;
			anotherInput.value = formattedValue;
		} else {
			input.value = '';
		}
	}
	function formattNumberr(input) {
		let value = input.value.replace(/[^0-9.]/g, '');
		let number = parseFloat(value);
		if (!isNaN(number)) {
			let formattedValue = number.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			input.value = formattedValue;
		} else {
			input.value = '';
		}
	}
</script>
<script>
	window.preventNonNumericInput = (element) => {
		element.addEventListener('keypress', function (e) {
			if (!/[\d.]/.test(e.key)) {
				e.preventDefault();
			}

			if (e.key === '.' && element.value.includes('.')) {
				e.preventDefault();
			}
		});
	}
</script>
@code {
	private bool disable = true;
  	private async Task CheckDeptslipAmt()
    {
		Console.WriteLine($"deptslipAmt :{deptslipAmt},currentStep :{currentStep}");
		if (deptslipAmt == null || deptslipAmt == 0)
		{
			disable = false;
			// ใช้ JavaScript แสดง Alert
			await JSRuntime.InvokeVoidAsync("alert", "ฝากเงินเป็น 0 ไม่ได้");
			if(currentStep == 2)
			{
				disable = true;
			}else{
				disable = false;
			}
		}
    }
	private string searchText;
	int selectedIndex = 0;
	private bool IsSaveEnabled => SaveStatus == "1";
	private Task AllowRowSelect(){
		allowRowSelectOnRowClick = true;
		return Task.CompletedTask;
	}

	private void OnChange(int newStep)
	{
		currentStep = newStep;
		Console.WriteLine("allowRowSelectOnRowClick"+allowRowSelectOnRowClick);
		StateHasChanged();
		@if (currentStep == 2)
		{
			@* PrintPdf(); *@
			disable = true;
		}
		
	}
	  private async Task PrintPdf()
    {
		try{ // รับ HTML จาก GetPdfData()
		slipLoading = true;
        string htmlData = await GetPdfData();
		@* Console.WriteLine(htmlData); *@
        // เรียกใช้ JavaScript Interop เพื่อแปลง HTML เป็น PDF และพิมพ์
        await jsRuntime.InvokeVoidAsync("printPdf", htmlData); 
		}catch(Exception ex)
		{
		Console.WriteLine(ex.Message);
			slipLoading=false;

		}finally{
			slipLoading=false;
			StateHasChanged();
		}
       

    }
private async Task<string> GetPdfData()
    {
        var InputHtml = $@"</head>
		<style>
			.form-control {{
				border: solid 1px #fff;
			}}
			.form-label {{
				font-weight: normal;
			}}
			.form-select {{
				font-size: 16px; /* ขนาดตัวอักษร */
				background-color: #fff;
			}}
			.row {{
				--bs-gutter-x: 1.5rem; 
				--bs-gutter-y: 0;
				display: flex;
				flex-wrap: wrap;
				margin-top: calc(var(--bs-gutter-y)* -1);
				/*margin-right: calc(var(--bs-gutter-x)* -0.5); 
				margin-left: calc(var(--bs-gutter-x)* -0.5); */
			}}
			@page {{   /* size: landscape;*/
				size: A4; 
				width: 297mm; 
				height: 210mm; 
				margin: 0;  
			}}
			@page :first {{
				margin-top: 0; /* ไม่มีขอบบน */
			}}
			.bodypt{{
				margin-top:-45px
			}}
		</style>
		<body class='bodypt'>
			<div class='row' style='width: 100%;'>";
			foreach (var content  in statement_data)
			{
				foreach (var item in content.slip_data){
					InputHtml += $@"
					<div style=' width: {item.point_width}%; margin-top: {item.point_top}px;'>
							<lable style='text-align: {item.align}; margin-top: {item.point_top}px; margin-left: {item.point_left}%; width: {item.point_width}%; vertical-align: top; font-family: {item.font_name}; font-size: {item.font_size}px;'>{item.column_value}</lable>
					</div>";
				}
			}
			InputHtml += @"
			</div>
		</body>";
		return InputHtml;
	}
	private async Task PrintBook_()
    {
			try{ 
		printLoading = true;
        string htmlData = await GetPrintBookData();
        // เรียกใช้ JavaScript Interop เพื่อแปลง HTML เป็น PDF และพิมพ์
        await jsRuntime.InvokeVoidAsync("printBook", htmlData); 
		}catch(Exception ex)
		{
		Console.WriteLine(ex.Message);
			printLoading=false;

		}finally{
			printLoading=false;
			StateHasChanged();
		}
    }
	 private async Task<string> GetPrintBookData()
    {
        var InputHtml = $@"
		<style>
		.body {{
            font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
        }}
		.left-align-no-border {{
			text-align: left;
			padding: 0px;
		}}
		.tablept{{
			width:100%;
			/* border:1px solid; */
			margin-left:-5px;
		}}
		@page {{
			size: A4;
			margin: 0px;
		}}
		 @page :first {{
        	margin-top: -10;
    	}}
		.row-detail {{
			margin: 0px;
			padding: 0px;
			border:1px solid transparent; 
        }}
		</style>
		</head>
		<body>
			<div class='row' style='width:100%;'>";
				@foreach (var content in printbook_data)
							{
								var printDetail = content.print_detail;
								foreach (var rowDetail in printDetail)
								{
									 InputHtml += @"
										<div class='tablept'>
										<div class='row-detail' style='padding:0px;margin:0px; display: flex; align-items: center;'>";

										foreach (var columnDetail in rowDetail.row_detail)
										{
											InputHtml += $@"
											<input type='text' style='text-align: {columnDetail.align}; margin-top: {columnDetail.point_top}px; margin-bottom: {columnDetail.point_bottom}px; margin-left: {columnDetail.point_left}px; width: {columnDetail.point_width}%; height: {columnDetail.point_height}%; vertical-align: top; font-family: {columnDetail.font_name}; font-size: {columnDetail.font_size}px; border: 0px solid ;' value='{columnDetail.column_value}' />";
										}
										InputHtml += @"
										</div>
										</div>";
								}
							}
			InputHtml += @"
			</div>
		</body>";
		return InputHtml;
	}
	// Event handler for RadzenSteps change
	// Event handler for RadzenSteps CanChange
	private bool CanChange()
	{
		Console.WriteLine($"return true;{true}");
		return true;
	}

	private Models.GetBank selectedCustomer;

	private RadzenDropDown<Models.GetBank> radzenDropDown;

	@* private class GetBank
	{
	public string bank_code { get; set; }
	public string bank_desc { get; set; }
	public string bank_name_e { get; set; }
	public string bank_shortname_t { get; set; }
	} *@

	IList<IDictionary<string, object>> accDetails; // Assuming this is your original data
	public IEnumerable<Models.AccountDetails> dataaccDetails { get; set; }
	private List<TableRow> rows = new List<TableRow>();
	private List<string> bankValuesList = new List<string>();	
	public class TableRow
	{
		public string? cheque_no { get; set; }
		public DateTime? cheque_date = DateTime.Now;
		public DateTime? entry_time { get; set; }
		public DateTime? chequedue_date { get; set; }
		public string? cheque_type { get; set; }
		public decimal? cheque_amt { get; set; }
		public int? seq_no { get; set; }
		public int? checkclear_status { get; set; }
		public string bank_code { get; set; }
		public string bank_desc { get; set; }
		public string bank_name_e { get; set; }
		public string bank_shortname_t { get; set; }
		public string branch_id { get; set; }
		public string branch_name { get; set; }
	}
	private void OnInitialized()
	{
		AddRow();
		StateHasChanged();
	}
	private void AddRow()
	{
		@* rows.Add(new TableRow()); *@
		var newRow = new TableRow
			{
				cheque_no = rows.Count > 0 ? rows[0].cheque_no : "0",
				cheque_date = rows.Count > 0 ? rows[0].cheque_date : DateTime.Now,
				bank_code = rows.Count > 0 ? rows[0].bank_code : "000",
				branch_id = rows.Count > 0 ? rows[0].branch_id : "0000",
			};
		rows.Add(newRow);
	}
	private void RemoveRow(TableRow row)
	{
		rows.Remove(row);
	}
	private string BankBranchValues { get; set; }
	private string BankValues { get; set; }
	private async Task OnBankBranchChanged(ChangeEventArgs e)
	{
		BankBranchValues = e.Value.ToString();
	}
	private async Task OnBankBranchSelectChanged(ChangeEventArgs e)
	{
		// กำหนดค่าที่ถูกเลือกใน <select> ให้กับ row.bank_code
		bankbranch_code = e.Value.ToString();
		BankBranchValues = bankbranch_code;
		Console.WriteLine(bankbranch_code);
	}
	private async Task OnGetBankChanged(ChangeEventArgs e)
	{
		BankValues = e.Value.ToString();
		Console.WriteLine($"BankValues: {BankValues}");
		await BankBranch();
        await InvokeAsync(() => StateHasChanged());
	}
	private async Task OnGetBankSelectChanged(ChangeEventArgs e)
	{
		// กำหนดค่าที่ถูกเลือกใน <select> ให้กับ row.bank_code
		bank_code = e.Value.ToString();
		Console.WriteLine($"BankValues: {bank_code}");
		BankValues = bank_code;
		await BankBranch();
        await InvokeAsync(() => StateHasChanged());

	}
@* } *@
@* @code {
private string formatMoneyValue;
private string showNumberValue;
private string previousData;

private void FormatMoneyFocus(FocusEventArgs e)
{
previousData = formatMoneyValue;
}

private void FormatMoneyChange(ChangeEventArgs e)
{
string itemAmount = e.Value.ToString();
itemAmount = FormatNumber(double.Parse(System.Text.RegularExpressions.Regex.Replace(itemAmount, "[^0-9.-]+",
"")));
formatMoneyValue = itemAmount;
}

private string FormatNumber(double input)
{
string value = showNumberValue?.Replace("[^0-9.]", "") ?? "";
double number = double.Parse(value);

if (!double.IsNaN(number))
{
string formattedValue = number.ToString("N2");
showNumberValue = formattedValue;
return formattedValue;
}
else
{
showNumberValue = "";
return "";
}
}
} *@
@* @code {
IList<IDictionary<string, object>> selectedItems;
int selectedIndex = 0;

public IEnumerable<IDictionary<string, object>> data { get; set; }

public IDictionary<string, Type> columns { get; set; }

public string GetColumnPropertyExpression(string name, Type type)
{
var expression = $@"it[""{name}""].ToString()";

if (type == typeof(int))
{
return $"int.Parse({expression})";
}
else if (type == typeof(DateTime))
{
return $"DateTime.Parse({expression})";
}

return expression;
}

protected override async Task OnInitializedAsync()
{
await base.OnInitializedAsync();

columns = new Dictionary<string, Type>()
{
{ "ต้นเงิน", typeof(int) },
{ "ต้นเงินคงเหลือ", typeof(string) },
{ "ยอดเงินทำรายการ", typeof(string) },
{ "วันที่ต้นเงิน", typeof(DateTime) },
{ "วันครบกำหนด", typeof(DateTime) },
{ "วันเริ่มคิดด/บถึง", typeof(DateTime) },
{ "วันคิดด/บถึง", typeof(DateTime) },
{ "ด/บ จ่าย", typeof(DateTime) },
{ "ภาษี", typeof(string) },
{ "ด/บ.หลังหักภาษี", typeof(DateTime) },
{ "ด/บค้าง", typeof(DateTime) },
{ "ค่าปรับ", typeof(string) },
{ "ด/บ เรียกคืน", typeof(DateTime) },
{ "ภาษี เรียกคืน", typeof(string) },
{ "อัตราดอกเบี้ย", typeof(string) },
{ "จำนวนวัน", typeof(string) },
};

foreach (var i in Enumerable.Range(0, 5))
{
columns.Add($"Column{i}", typeof(string));
}

data = Enumerable.Range(0, 20).Select(i =>
{
var row = new Dictionary<string, object>();

foreach (var column in columns)
{
row.Add(column.Key, column.Value == typeof(int) ? i :
column.Value == typeof(DateTime) ? DateTime.Now.AddMonths(i) : $"{column.Key}{i}");
}

return row;
});
}
} *@
@* @code {
// ตัวแปรสำหรับเก็บค่าที่เลือกใน dropdown แรก
private string selectedValue;
private string cashTypeValue;


// Event handler สำหรับ dropdown แรก
private void RecpPayTypeChanged(ChangeEventArgs e)
{
// เมื่อมีการเปลี่ยนแปลงค่าใน dropdown แรก
// ให้กำหนดค่าที่เลือกใน dropdown ที่สองเป็นค่าเดียวกัน
selectedValue = e.Value.ToString();
ShowCashType();
}

private void ShowCashType()
{
cashTypeValue = selectedValue;
}

private string deptslipAmt;
private async Task CheckNumber(KeyboardEventArgs e)
{
int e_k = e.Key[0]; // ดึงค่า char แรกจาก Key

// 13 = Enter, 46 = .
if (e_k != 13 && e_k != 46 && (e_k < 48 || e_k > 57))
{
// ไม่ให้ผ่านค่าเข้ามา
await jsRuntime.InvokeVoidAsync("alert", "กรุณากรอกเฉพาะตัวเลขเท่านั้น!");
}
}*@
} 
